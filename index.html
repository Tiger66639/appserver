<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-dark.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <title>Appserver by Tiger66639</title>
  </head>

  <body>

    <header>
      <div class="container">
        <h1>Appserver</h1>
        <h2>A multithreaded application server for PHP, written in PHP.</h2>

        <section id="downloads">
          <a href="https://github.com/Tiger66639/appserver/zipball/master" class="btn">Download as .zip</a>
          <a href="https://github.com/Tiger66639/appserver/tarball/master" class="btn">Download as .tar.gz</a>
          <a href="https://github.com/Tiger66639/appserver" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <h1>
<a id="appserverio-a-php-application-server" class="anchor" href="#appserverio-a-php-application-server" aria-hidden="true"><span class="octicon octicon-link"></span></a>appserver.io, a PHP application server</h1>

<p><a href="https://gitter.im/appserver-io/appserver?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge"><img src="https://badges.gitter.im/Join%20Chat.svg" alt="Gitter"></a>
 <a href="http://travis-ci.org/appserver-io/appserver"><img src="https://img.shields.io/travis/appserver-io/appserver/master.svg?style=flat-square" alt="Build Status"></a>
 <a href="https://scrutinizer-ci.com/g/appserver-io/appserver/?branch=master"><img src="https://img.shields.io/scrutinizer/g/appserver-io/appserver/master.svg?style=flat-square" alt="Scrutinizer Code Quality"></a>
 <a href="https://scrutinizer-ci.com/g/appserver-io/appserver/?branch=master"><img src="https://img.shields.io/scrutinizer/coverage/g/appserver-io/appserver/master.svg?style=flat-square" alt="Code Coverage"></a></p>

<p>This is the main repository for the <a href="http://www.appserver.io/">appserver.io</a> project.</p>

<p>appserver.io is a multithreaded application server for PHP, written
in PHP. Yes, pure PHP! If you know anything about PHP, you're probably thinking we might be crazy. Well, we aren't. We are dead serious (but we most certainly still love having fun!).</p>

<p>appserver.io overcomes some of the biggest overhead issues most PHP (CGI) programs have in common, through a blazingly fast and rock solid infrastructure and with concepts new to PHP. At the same time, appserver.io offers PHP developers the fundamental core features found in most popular frameworks today, yet not intending to be a framework at all. It is a suprizingly fun infrastructure for PHP development, allowing you to build powerful applications without needing the bulk of a PHP framework.</p>

<p>appserver.io includes great features like...</p>

<ul>
<li>Its own performant Web Server and HTTP foundation.</li>
<li>A powerful Servlet Engine, with true multi-threading</li>
<li>A Dependency Injection Container, for building modern, modular and testable code</li>
<li>Multiple Persistence Containers, for sessions and other stateful components</li>
<li>A Message Queue System, for contolling the execution of long running tasks</li>
<li>A Timer Service, for running scheduled tasks</li>
</ul>

<p>and much more.</p>

<p>appserver.io also supports <a href="http://en.wikipedia.org/wiki/Aspect-oriented_programming">Aspect Oriented Programming</a>(AOP), which is a programming paradigm also found in the most popular frameworks today, like Laravel. AOP allows the separation of cross-cutting concerns within a program, allowing developers to create even more modular systems.</p>

<p>With appserver.io, it is our goal to establish a solution as the next standard for enterprise applications written in PHP. With your help, we can reach this goal.</p>

<p>Give it a try!</p>

<h4>
<a id="table-of-contents" class="anchor" href="#table-of-contents" aria-hidden="true"><span class="octicon octicon-link"></span></a>Table of Contents</h4>

<ul>
<li><a href="#semantic-versioning">Semantic Versioning</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#basic-usage">Basic Usage</a></li>
<li><a href="#https-server">HTTP Server</a></li>
<li><a href="#servlet-engine">Servlet-Engine</a></li>
<li><a href="#annotations">Annotations</a></li>
<li><a href="#dependency-injection">Dependency Injection</a></li>
<li><a href="#persistence-container">Persistence-Container</a></li>
<li><a href="#message-queue">Message-Queue</a></li>
<li><a href="#timer-service">Timer-Service</a></li>
<li><a href="#aop">AOP</a></li>
<li><a href="#design-by-contract">Design-by-Contract</a></li>
<li><a href="#runtime-environment">Runtime Environment</a></li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#deployment">Deployment</a></li>
<li><a href="#uninstall">Uninstall</a></li>
</ul>

<h1>
<a id="semantic-versioning" class="anchor" href="#semantic-versioning" aria-hidden="true"><span class="octicon octicon-link"></span></a>Semantic Versioning</h1>

<p>appserver.io follows semantic versioning. For the purpose of defining a public API we introduced <a href="http://appserver.io/get-started/psrs.html">appserver.io specific <code>PSRs</code></a>. These PSRs are the core to appserver.io's public API, but within their own definition and versioning, meaning that <strong>semantic versioning applies to these PSRs and not the appserver package itself</strong>.</p>

<h1>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h1>

<p>appserver.io can be installed on several operating systems. It also supports several methods of acquiring the software. To get your appserver.io package you can do one of the following:</p>

<ul>
<li><p>Download one of our <a href="https://github.com/appserver-io/appserver/releases"><strong>releases</strong></a>
right from this repository which provide tested install packages</p></li>
<li><p>Grab any of our <a href="http://builds.appserver.io/"><strong>nightlies</strong></a> from our project page to get
bleeding edge install packages, (and may also containg bugs - only for testing and not for production use!!)</p></li>
<li><p>Build your own package using <a href="http://ant.apache.org/">ANT</a>! To do so clone the <a href="https://github.com/appserver-io-php/runtime">runtime</a> first. Then update at least the <code>os.family</code> and <code>os.distribution</code> build properties according to your environment and build the appserver with the ANT <code>build</code> and <code>create-package</code> target.</p></li>
</ul>

<p>The package will install with these basic default characteristics:</p>

<ul>
<li>Install dir: <code>/opt/appserver</code>
</li>
<li>Autostart after installation, no autostart on reboot</li>
<li>Reachable under pre-configured ports as described <a href="#basic-usage">here</a>
</li>
</ul>

<p>For OS specific steps and characteristics see below for tested environments.</p>

<h2>
<a id="mac-os-x" class="anchor" href="#mac-os-x" aria-hidden="true"><span class="octicon octicon-link"></span></a>Mac OS X</h2>

<blockquote>
<p>Runs and tested on Mac OS X 10.8.x and higher!</p>
</blockquote>

<p>For Mac OS X &gt; 10.8.x we provide a <code>.pkg</code> file for <a href="http://appserver.io/get-started/downloads.html#mac-osx">download</a> that contains the runtime and the distribution. Double-clicking on the <code>.pkg</code> starts and guides you through the installation process.</p>

<h2>
<a id="windows" class="anchor" href="#windows" aria-hidden="true"><span class="octicon octicon-link"></span></a>Windows</h2>

<blockquote>
<p>Runs and tested on Windows 7 (32-bit) and higher!</p>
</blockquote>

<p>As we deliver the Windows appserver as a .jar file you can <a href="http://appserver.io/get-started/downloads.html#windows">download</a>, a installed Java Runtime Environment (or JDK
that is) is a vital requirement for using it. If the JRE/JDK is not installed, you have to do so
first. You can get the JRE from <a href="http://www.oracle.com/technetwork/java/javase/downloads/jre7-downloads-1880261.html">Oracle's download page</a>.
If this requirement is met you can start the installation by simply double-clicking the .jar archive.</p>

<h2>
<a id="debian" class="anchor" href="#debian" aria-hidden="true"><span class="octicon octicon-link"></span></a>Debian</h2>

<blockquote>
<p>Runs and tested on Debian Squeeze (64-bit) and higher!</p>
</blockquote>

<p>If you're on a Debian system you might also try our <code>.deb</code> repository:</p>

<pre><code>root@debian:~# echo "deb http://deb.appserver.io/ wheezy main" &gt; /etc/apt/sources.list.d/appserver.list
root@debian:~# wget http://deb.appserver.io/appserver.gpg -O - | apt-key add -
root@debian:~# aptitude update
root@debian:~# aptitude install appserver-dist
</code></pre>

<p>Optionally you can <a href="http://appserver.io/get-started/downloads.html#debian">download</a> the <code>.deb</code> files and install them by double-clicking on them. This will invoke the system default package manager and guides you through the installation process. Please install the runtime first, as this is a dependency for the distribution.</p>

<h2>
<a id="fedora" class="anchor" href="#fedora" aria-hidden="true"><span class="octicon octicon-link"></span></a>Fedora</h2>

<blockquote>
<p>Runs and tested on versions Fedora 20 (64-bit) and higher!</p>
</blockquote>

<p>We  also provide <code>.rpm</code> <a href="http://appserver.io/get-started/downloads.html#fedora">files</a> for Fedora, that you can download and start the installation process by double-clicking on it. This will start the systems default package manager and guides you through the installation process.</p>

<h2>
<a id="centos" class="anchor" href="#centos" aria-hidden="true"><span class="octicon octicon-link"></span></a>CentOS</h2>

<blockquote>
<p>Runs and tested on CentOS 6.5 (64-bit) and higher!</p>
</blockquote>

<p>Installation and basic usage is the same as on Fedora, but we provide different <a href="http://appserver.io/get-started/downloads.html#cent-os">packages</a>. CentOS requires additional repositories
like <a href="http://rpms.famillecollet.com/">remi</a> or <a href="http://fedoraproject.org/wiki/EPEL">EPEL</a> to
satisfy additional dependencies.</p>

<h2>
<a id="raspbian" class="anchor" href="#raspbian" aria-hidden="true"><span class="octicon octicon-link"></span></a>Raspbian</h2>

<p>As an experiment we offer a Raspbian and brought the appserver to an ARM environment. What should
we say, it worked! :D With <code>os.distribution</code> = raspbian you might give it a try and build it
yourself. Plan for at least 5 hours though, as we currently do not offer prepared install package.</p>

<h1>
<a id="basic-usage" class="anchor" href="#basic-usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Basic Usage</h1>

<p>The appserver will automatically start after your installation wizard (or package manager) finishes
the setup. You can use it without limitations after installation is completed..</p>

<p>Below you can find basic instructions on how to make use of the appserver. After the installation,
you might want to have a look at the example application, which is also included with the installation. You can reach the app at <code>http://127.0.0.1:9080/example</code></p>

<p>Start your favorite browser and have a look at what appserver can do. :) To enter the site, use
the default login <code>appserver/appserver.i0</code>.</p>

<h2>
<a id="start-and-stop-scripts" class="anchor" href="#start-and-stop-scripts" aria-hidden="true"><span class="octicon octicon-link"></span></a>Start and Stop Scripts</h2>

<p>There are several standalone processes, which are needed for the proper
functioning of different features within appserver.</p>

<p>There are start and stop scripts included in appserver for all *nix like operating systems.
These work the same as on any other *nix systems. They are:</p>

<ul>
<li><p><code>appserver</code>: The main process which will start the appserver itself</p></li>
<li><p><code>appserver-php5-fpm</code>: php-fpm + appserver configuration. Our default FastCGI backend. Other FCGI system can be added the same way.</p></li>
<li><p><code>appserver-watcher</code>: A watchdog which monitors filesystem changes and manages appserver restarts</p></li>
</ul>

<p>On a normal system, all three of these processes should run to enable the full feature set. To
ultimately run the appserver, only the appserver process is needed. However, you will miss simple on-the-fly
deployment (<code>appserver-watcher</code>) and might have problems with legacy applications.</p>

<p>Depending on the FastCGI backend you want to use, you might ditch <code>appserver-php5-fpm</code> for other
processes e.g. you could also use an <a href="http://hhvm.com/">hhvm</a> backend.</p>

<p>Currently we support three different types of init scripts, which support the commands <code>start</code>, <code>stop</code>,
<code>status</code> and <code>restart</code> (additional commands might be available on other systems).</p>

<p><strong>Mac OS X (LAUNCHD)</strong>
The LAUNCHD launch daemons are located within the appserver installation at <code>/opt/appserver/sbin</code>.
They can be used with the schema <code>/opt/appserver/sbin/&lt;DAEMON&gt; &lt;COMMAND&gt;</code></p>

<p><strong>Debian, Raspbian, CentOS, ...(SystemV)</strong>
Commonly known and located in <code>/etc/init.d/</code> they too support the commands mentioned above provided
in the form <code>/etc/init.d/&lt;DAEMON&gt; &lt;COMMAND&gt;</code>.</p>

<p><strong>Fedora, ... (systemd)</strong>
systemd init scripts can be used using the <code>systemctl</code> command with the syntax <code>systemctl &lt;COMMAND&gt; &lt;DAEMON&gt;</code>.</p>

<p><strong>Windows</strong></p>

<p>On Windows we sadly do not offer any of these scripts. After the installation, you can start the
Application Server with the <code>server.bat</code> file located within the root directory of your installation.
Best thing to do would be starting a command prompt as an administrator and run the following commands
(assuming default installation path):</p>

<pre><code>C:\Windows\system32&gt;cd "C:\Program Files\appserver"
C:\Program Files\appserver&gt;server.bat
</code></pre>

<h1>
<a id="https-server" class="anchor" href="#https-server" aria-hidden="true"><span class="octicon octicon-link"></span></a>HTTP(S) Server</h1>

<p>The configuration of the HTTP(S) Server itself is mostly self-explanatory, so just have a look at the default config
file and, if you'd like, try to change the settings.
Please make sure you restart the appserver after making any changes. :)
A detailed overview of all configuration settings will follow ...</p>

<h2>
<a id="configure-a-virtual-host" class="anchor" href="#configure-a-virtual-host" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configure a Virtual Host</h2>

<p>Using virtual hosts, you can extend the default server configuration and produce a host specific
environment for your app to run.</p>

<p>You can do so by adding a virtual host configuration to your global server configuration file. See
the example for a XML based configuration below:</p>

<div class="highlight highlight-text-xml"><pre>&lt;<span class="pl-ent">virtualHosts</span>&gt;
  &lt;<span class="pl-ent">virtualHost</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>example.local<span class="pl-pds">"</span></span>&gt;
    &lt;<span class="pl-ent">params</span>&gt;
      &lt;<span class="pl-ent">param</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>admin<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span>&gt;
        admin@appserver.io
      &lt;/<span class="pl-ent">param</span>&gt;
      &lt;<span class="pl-ent">param</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>documentRoot<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span>&gt;
        /opt/appserver/webapps/example
      &lt;/<span class="pl-ent">param</span>&gt;
    &lt;/<span class="pl-ent">params</span>&gt;
  &lt;/<span class="pl-ent">virtualHost</span>&gt;
&lt;/<span class="pl-ent">virtualHosts</span>&gt;</pre></div>

<p>The above configuration sits within the server element and opens up the virtual host <code>example.local</code>
which has a different document root than the global configuration has. The virtual host is born. :-)</p>

<p>The <code>virtualHost</code> element can hold params, rewrite rules or environment variables which are only
available for the host specifically.</p>

<h2>
<a id="configure-your-environment-variables" class="anchor" href="#configure-your-environment-variables" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configure your Environment Variables</h2>

<p>You can set environment variables using either the global or the virtual host based configuration.
The example below shows a basic usage of environment variables in XML format.</p>

<div class="highlight highlight-text-xml"><pre>&lt;<span class="pl-ent">environmentVariables</span>&gt;
  &lt;<span class="pl-ent">environmentVariable</span>
    <span class="pl-e">condition</span>=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>
    <span class="pl-e">definition</span>=<span class="pl-s"><span class="pl-pds">"</span>EXAMPLE_VAR=example<span class="pl-pds">"</span></span> /&gt;
  &lt;<span class="pl-ent">environmentVariable</span>
    <span class="pl-e">condition</span>=<span class="pl-s"><span class="pl-pds">"</span>Apple@$HTTP_USER_AGENT<span class="pl-pds">"</span></span>
    <span class="pl-e">definition</span>=<span class="pl-s"><span class="pl-pds">"</span>USER_HAS_APPLE=true<span class="pl-pds">"</span></span> /&gt;
&lt;/<span class="pl-ent">environmentVariables</span>&gt;</pre></div>

<p>There are several ways in which this feature is used. You can get a rough idea when having a
look at Apache modules <a href="http://httpd.apache.org/docs/2.2/mod/mod_env.html">mod_env</a> and
<a href="http://httpd.apache.org/docs/2.2/mod/mod_setenvif.html">mod_setenvif</a> which we adopted.</p>

<p>You can make definitions of environment variables dependent on REGEX based conditions which will
be performed on so called backreferences. These backreferences are request related server variables
like <code>HTTP_USER_AGENT</code>.</p>

<p>A condition has the format <code>&lt;REGEX_CONDITION&gt;@$&lt;BACKREFERENCE&gt;</code>. If the condition is empty the
environment variable will be set every time.</p>

<p>The definition you can use has the form <code>&lt;NAME_OF_VAR&gt;=&lt;THE_VALUE_TO_SET&gt;</code>. The definition has
some specialities too:</p>

<ul>
<li>Setting a var to <code>null</code> will unset the variable if it existed before</li>
<li>You can use backreferences for the value you want to set as well. But those are limited to
environment variables of the PHP process</li>
<li>Values will be treated as strings</li>
</ul>

<h1>
<a id="servlet-engine" class="anchor" href="#servlet-engine" aria-hidden="true"><span class="octicon octicon-link"></span></a>Servlet-Engine</h1>

<p>Originally Java Servlets were Java's counterpart to other dynamic web technologies like PHP or the
Microsoft .NET platform. In contrast to PHP, a Servlet written in Java is not a script that will
be interpreted per request. Instead, it is a class, which is instantiated, when the Servlet Engine starts up.
This means, the servlet class is already in memory and stays in memory.</p>

<blockquote>
<p>In most cases, this is a major advantage compared to the common PHP way to constantly reload the script on each
request. Since most PHP applications are based on frameworks like Symfony or Laravel have grown
immensly during the last few years, the reloading of all the script files required by the application,
slows down performance considerably. This is one of the reasons why caching is a major
part of all good PHP frameworks. On one hand, caching improves performance enough so
the application responds to the request in an acceptable timeframe. On the other hand, it is also the
origin of many problems, such as how to invalidate parts of the cache during an applications
runtime.</p>
</blockquote>

<p>Servlets enable you to implement your application logic as you normally would, but without the need to worry about the expensive
reloading process, which is common to normal PHP applications. A Servlet is a super
fast and simple way to implement an entry point to handle HTTP requests, which allow you to
execute all performance critical tasks, like bootstrapping (with a simple method called <code>init()</code>), when
the Servlet Engine starts up.</p>

<h2>
<a id="what-is-a-servlet" class="anchor" href="#what-is-a-servlet" aria-hidden="true"><span class="octicon octicon-link"></span></a>What is a Servlet</h2>

<p>A Servlet is a simple class that has to extend from <code>AppserverIo\Psr\Servlet\Http\HttpServlet</code>.
Your application logic can then be implemented by overwriting the <code>service()</code> method or better
by overwriting the request specific methods like <code>doGet()</code> if you want to handle a GET request.</p>

<h2>
<a id="create-a-simple-servlet" class="anchor" href="#create-a-simple-servlet" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create a simple Servlet</h2>

<p>Let's write a simple example and start with a famous <code>Hello World</code> servlet</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">namespace</span> <span class="pl-en">Namespace\Module</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">AppserverIo\Psr\Servlet\ServletConfigInterface</span>;</span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">AppserverIo\Psr\Servlet\Http\HttpServlet</span>;</span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">AppserverIo\Psr\Servlet\Http\HttpServletRequestInterface</span>;</span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">AppserverIo\Psr\Servlet\Http\HttpServletResponseInterface</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c"> * This is the famous 'Hello World' as servlet implementation.</span></span>
<span class="pl-s1"><span class="pl-c"> *</span></span>
<span class="pl-s1"><span class="pl-c"> * @Route(name="helloWorld",</span></span>
<span class="pl-s1"><span class="pl-c"> *        displayName="I'm the 'Hello World!' servlet",</span></span>
<span class="pl-s1"><span class="pl-c"> *        description="A annotated 'Hello World!' servlet implementation.",</span></span>
<span class="pl-s1"><span class="pl-c"> *        urlPattern={"/helloWorld.do", "/helloWorld.do*"})</span></span>
<span class="pl-s1"><span class="pl-c"> */</span></span>
<span class="pl-s1"><span class="pl-k">class</span> <span class="pl-en">HelloWorldServlet</span> <span class="pl-k">extends</span> <span class="pl-e">HttpServlet</span></span>
<span class="pl-s1">{</span>
<span class="pl-s1"></span>
<span class="pl-s1">  <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">   * The text to be rendered.</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@var</span> string</span></span>
<span class="pl-s1"><span class="pl-c">   */</span></span>
<span class="pl-s1">  <span class="pl-k">protected</span> <span class="pl-smi">$helloWorld</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">  <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">   * Initializes the servlet with the passed configuration.</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@param</span> \AppserverIo\Psr\Servlet\ServletConfigInterface $config</span></span>
<span class="pl-s1"><span class="pl-c">   *   The configuration to initialize the servlet with</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@return</span> void</span></span>
<span class="pl-s1"><span class="pl-c">   */</span></span>
<span class="pl-s1">  <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">init</span>(<span class="pl-c1">ServletConfigInterface</span> <span class="pl-smi">$config</span>)</span>
<span class="pl-s1">  {</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">// call parent method</span></span>
<span class="pl-s1">    <span class="pl-k">parent</span><span class="pl-k">::</span>init(<span class="pl-smi">$config</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">// prepare the text here</span></span>
<span class="pl-s1">    <span class="pl-smi">$this</span><span class="pl-k">-&gt;</span><span class="pl-smi">helloWorld</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Hello World!<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">// @todo Do all the bootstrapping here, because this method will</span></span>
<span class="pl-s1">    <span class="pl-c">//       be invoked only once when the Servlet Engines starts up</span></span>
<span class="pl-s1">  }</span>
<span class="pl-s1"></span>
<span class="pl-s1">  <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">   * Handles a HTTP GET request.</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@param</span> \AppserverIo\Psr\Servlet\Http\HttpServletRequestInterface  $servletRequest</span></span>
<span class="pl-s1"><span class="pl-c">   *   The request instance</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@param</span> \AppserverIo\Psr\Servlet\Http\HttpServletResponseInterface $servletResponse</span></span>
<span class="pl-s1"><span class="pl-c">   *   The response instance</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@return</span> void</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@see</span> \AppserverIo\Psr\Servlet\Http\HttpServlet::doGet()</span></span>
<span class="pl-s1"><span class="pl-c">   */</span></span>
<span class="pl-s1">  <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">doGet</span>(</span>
<span class="pl-s1">    <span class="pl-c1">HttpServletRequestInterface</span> <span class="pl-smi">$servletRequest</span>,</span>
<span class="pl-s1">    <span class="pl-c1">HttpServletResponseInterface</span> <span class="pl-smi">$servletResponse</span>)</span>
<span class="pl-s1">  {</span>
<span class="pl-s1">    <span class="pl-smi">$servletResponse</span><span class="pl-k">-&gt;</span>appendBodyStream(<span class="pl-smi">$this</span><span class="pl-k">-&gt;</span><span class="pl-smi">helloWorld</span>);</span>
<span class="pl-s1">  }</span>
<span class="pl-s1">}</span></pre></div>

<p>and save it as <code>/opt/appserver/webapps/myapp/WEB-INF/classes/Namespace/Module/HelloWorldServlet.php</code>.</p>

<p>Is that all? Yes! <a href="#start-and-stop-scripts">Restart</a> the application server and open
<code>http://127.0.0.1:9080/myapp/helloWorld.do</code> in your favorite browser, and ... v√≥ila :)</p>

<blockquote>
<p>A restart is always required since you changed code in your Servlet, because the Servlet
will be loaded and initialized when the the application server starts. Without a restart
the application server will not know you had made any changes.</p>
</blockquote>

<h1>
<a id="annotations" class="anchor" href="#annotations" aria-hidden="true"><span class="octicon octicon-link"></span></a>Annotations</h1>

<p>Since one of our main goals is to make configuration as simple as possible, we decided to use
annotations wherever possible. As annotations are not supported natively by PHP, we provide
annotation support over our <a href="https://github.com/appserver-io/lang">lang</a> package.</p>

<p>Beside the use of annotations in our application server components, it will also be possible to extend your
application with annotations by using the functionality appserver delivers out-of-the-box.</p>

<p>If you, for example, think about extending the actions of the controller component in your
MVC framework with a <a href="https://github.com/Route" class="user-mention">@Route</a> annotation, you can do that in the following way</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">namespace</span> <span class="pl-en">Namespace\Module</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">AppserverIo\Appserver\Lang\Reflection\ReflectionClass</span>;</span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">AppserverIo\Appserver\Lang\Reflection\ReflectionAnnotation</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">class</span> <span class="pl-en">Route</span> <span class="pl-k">extends</span> <span class="pl-e">ReflectionAnnotation</span></span>
<span class="pl-s1">{</span>
<span class="pl-s1"></span>
<span class="pl-s1">  <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">   * Returns the value of the name attribute.</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@return</span> string The annotations name attribute</span></span>
<span class="pl-s1"><span class="pl-c">   */</span></span>
<span class="pl-s1">  <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">getPattern</span>()</span>
<span class="pl-s1">  {</span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-smi">$this</span><span class="pl-k">-&gt;</span><span class="pl-smi">values</span>[<span class="pl-s"><span class="pl-pds">'</span>pattern<span class="pl-pds">'</span></span>];</span>
<span class="pl-s1">  }</span>
<span class="pl-s1">}</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">class</span> <span class="pl-en">IndexController</span></span>
<span class="pl-s1">{</span>
<span class="pl-s1"></span>
<span class="pl-s1">  <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">   * Default action implementation.</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@return</span> void</span></span>
<span class="pl-s1"><span class="pl-c">   * @Route(pattern="/index/index")</span></span>
<span class="pl-s1"><span class="pl-c">   */</span></span>
<span class="pl-s1">  <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">indexAction</span>()</span>
<span class="pl-s1">  {</span>
<span class="pl-s1">    <span class="pl-c">// do something here</span></span>
<span class="pl-s1">  }</span>
<span class="pl-s1">}</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">// create a reflection class to load the methods annotation</span></span>
<span class="pl-s1"><span class="pl-smi">$reflectionClass</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">ReflectionClass</span>(<span class="pl-s"><span class="pl-pds">'</span>IndexController<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$reflectionMethod</span> <span class="pl-k">=</span> <span class="pl-smi">$reflectionClass</span><span class="pl-k">-&gt;</span>getMethod(<span class="pl-s"><span class="pl-pds">'</span>indexAction<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$reflectionAnnotation</span> <span class="pl-k">=</span> <span class="pl-smi">$reflectionMethod</span><span class="pl-k">-&gt;</span>getAnnotation(<span class="pl-s"><span class="pl-pds">'</span>Route<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$pattern</span> <span class="pl-k">=</span> <span class="pl-smi">$reflectionAnnotation</span><span class="pl-k">-&gt;</span>newInstance()<span class="pl-k">-&gt;</span>getPattern();</span></pre></div>

<p>Most of the annotation implementations provided by our <a href="https://github.com/appserver-io-psr/epb">Enterprise Beans</a>
PSR and used for <a href="#dependency-injection">Dependency Injection</a>, which will be described below,
are based on that annotation implementation.</p>

<h1>
<a id="dependency-injection" class="anchor" href="#dependency-injection" aria-hidden="true"><span class="octicon octicon-link"></span></a>Dependency Injection</h1>

<p>Dependency Injection(DI) enables developers to write cleaner, reusable and maintainable
code with less coupling by injecting necessary instances at runtime, instead of instantiating them in
the class itself. Within the application server, each application has its own scope and therefore its
own dependency injection container. This prevents your application from fatal errors like <code>Cannot redeclare class ...</code>.</p>

<h2>
<a id="what-can-be-injected" class="anchor" href="#what-can-be-injected" aria-hidden="true"><span class="octicon octicon-link"></span></a>What can be injected</h2>

<p>Generally everything! The application server itself doesn't use DI, instead it provides DI as a
service for the applications running within it. But, before you can let the DI container inject an
instance to your class, you have to register it. Registering a class for DI is pretty simple. To
register a class in the DI container the most common way is to use annotations.</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">namespace</span> <span class="pl-en">Namespace\Modulename</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c"> * @Stateless(name="MyStatefulSessionBean")</span></span>
<span class="pl-s1"><span class="pl-c"> */</span></span>
<span class="pl-s1"><span class="pl-k">class</span> <span class="pl-en">MyStatefulSessionBean</span></span>
<span class="pl-s1">{</span>
<span class="pl-s1">}</span></pre></div>

<p>When the application server starts, it parses the <code>META-INF/classes</code> and <code>WEB-INF/classes</code> folder
classes with supported annotations. If a class is found, the class will be registered in the
application servers naming directory under the name you specify in the annotations <code>name</code> Attribute,
in this example <code>MyStatefulSessionBean</code>.</p>

<h2>
<a id="how-to-inject-an-instance" class="anchor" href="#how-to-inject-an-instance" aria-hidden="true"><span class="octicon octicon-link"></span></a>How to inject an instance</h2>

<p>Basically DI can be a manual process where you <code>inject</code> an instance, needed by another class by
passing it to the constructor. Inside the application server, the injection is a process you can't
see, it's more a kind of magic that happens behind the scenes. So instead of manually passing the
necessary instances to a classes constructor, the DI container will do that for you.</p>

<p>You simply have to tell the DI container what you need. Let's have a look at how that is done.</p>

<h3>
<a id="property-injection" class="anchor" href="#property-injection" aria-hidden="true"><span class="octicon octicon-link"></span></a>Property Injection</h3>

<p>The first possibility we have is to annotate a class property</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">namespace</span> <span class="pl-en">Namespace\Module</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">AppserverIo\Psr\Servlet\ServletConfigInterface</span>;</span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">AppserverIo\Psr\Servlet\Http\HttpServlet</span>;</span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">AppserverIo\Psr\Servlet\Http\HttpServletRequestInterface</span>;</span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">AppserverIo\Psr\Servlet\Http\HttpServletResponseInterface</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c"> * This is the famous 'Hello World' as servlet implementation.</span></span>
<span class="pl-s1"><span class="pl-c"> */</span></span>
<span class="pl-s1"><span class="pl-k">class</span> <span class="pl-en">HelloWorldServlet</span> <span class="pl-k">extends</span> <span class="pl-e">HttpServlet</span></span>
<span class="pl-s1">{</span>
<span class="pl-s1"></span>
<span class="pl-s1">  <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">   * The SessionBean instance we want to have injected.</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@var</span> \Namespace\Modulename\MyStatefulSessionBean</span></span>
<span class="pl-s1"><span class="pl-c">   * @EnterpriseBean(name="MyStatefulSessionBean")</span></span>
<span class="pl-s1"><span class="pl-c">   */</span></span>
<span class="pl-s1">  <span class="pl-k">protected</span> <span class="pl-smi">$myStatefulSessionBean</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">  <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">   * The text to be rendered.</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@var</span> string</span></span>
<span class="pl-s1"><span class="pl-c">   */</span></span>
<span class="pl-s1">  <span class="pl-k">protected</span> <span class="pl-smi">$helloWorld</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">  <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">   * Initializes the servlet with the passed configuration.</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@param</span> \AppserverIo\Psr\Servlet\ServletConfigInterface $config</span></span>
<span class="pl-s1"><span class="pl-c">   *   The configuration to initialize the servlet with</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@return</span> void</span></span>
<span class="pl-s1"><span class="pl-c">   */</span></span>
<span class="pl-s1">  <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">init</span>(<span class="pl-c1">ServletConfigInterface</span> <span class="pl-smi">$config</span>)</span>
<span class="pl-s1">  {</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">// call parent method</span></span>
<span class="pl-s1">    <span class="pl-k">parent</span><span class="pl-k">::</span>init(<span class="pl-smi">$config</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">// prepare the text here</span></span>
<span class="pl-s1">    <span class="pl-smi">$this</span><span class="pl-k">-&gt;</span><span class="pl-smi">helloWorld</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Hello World!<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">// @todo Do all the bootstrapping here, because this method will</span></span>
<span class="pl-s1">    <span class="pl-c">//       be invoked only once when the Servlet Engines starts up</span></span>
<span class="pl-s1">  }</span>
<span class="pl-s1"></span>
<span class="pl-s1">  <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">   * Handles a HTTP GET request.</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@param</span> \AppserverIo\Psr\Servlet\Http\HttpServletRequestInterface  $servletRequest</span></span>
<span class="pl-s1"><span class="pl-c">   *   The request instance</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@param</span> \AppserverIo\Psr\Servlet\Http\HttpServletResponseInterface $servletResponse</span></span>
<span class="pl-s1"><span class="pl-c">   *   The response instance</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@return</span> void</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@see</span> \AppserverIo\Psr\Servlet\Http\HttpServlet::doGet()</span></span>
<span class="pl-s1"><span class="pl-c">   */</span></span>
<span class="pl-s1">  <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">doGet</span>(</span>
<span class="pl-s1">    <span class="pl-c1">HttpServletRequestInterface</span> <span class="pl-smi">$servletRequest</span>,</span>
<span class="pl-s1">    <span class="pl-c1">HttpServletResponseInterface</span> <span class="pl-smi">$servletResponse</span>)</span>
<span class="pl-s1">  {</span>
<span class="pl-s1">    <span class="pl-smi">$servletResponse</span><span class="pl-k">-&gt;</span>appendBodyStream(<span class="pl-smi">$this</span><span class="pl-k">-&gt;</span><span class="pl-smi">helloWorld</span>);</span>
<span class="pl-s1">  }</span>
<span class="pl-s1">}</span></pre></div>

<p>With the <code>name</code> attribute of the <code>@EnterpriseBean</code> annotation, you have the possibility to specify the
name of the bean you registered before by annotating it. A more detailed description about the
available annotations is part of the <a href="#persistence-container">Persistence-Container</a>.</p>

<h3>
<a id="setter-injection" class="anchor" href="#setter-injection" aria-hidden="true"><span class="octicon octicon-link"></span></a>Setter Injection</h3>

<p>The second possibility to inject an instance is setter injection.</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">namespace</span> <span class="pl-en">Namespace\Module</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">AppserverIo\Psr\Servlet\ServletConfigInterface</span>;</span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">AppserverIo\Psr\Servlet\Http\HttpServlet</span>;</span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">AppserverIo\Psr\Servlet\Http\HttpServletRequestInterface</span>;</span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">AppserverIo\Psr\Servlet\Http\HttpServletResponseInterface</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c"> * This is the famous 'Hello World' as servlet implementation.</span></span>
<span class="pl-s1"><span class="pl-c"> */</span></span>
<span class="pl-s1"><span class="pl-k">class</span> <span class="pl-en">HelloWorldServlet</span> <span class="pl-k">extends</span> <span class="pl-e">HttpServlet</span></span>
<span class="pl-s1">{</span>
<span class="pl-s1"></span>
<span class="pl-s1">  <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">   * The SessionBean instance we want to have injected.</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@var</span> \Namespace\Modulename\MyStatefulSessionBean</span></span>
<span class="pl-s1"><span class="pl-c">   */</span></span>
<span class="pl-s1">  <span class="pl-k">protected</span> <span class="pl-smi">$myStatefulSessionBean</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">  <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">   * The text to be rendered.</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@var</span> string</span></span>
<span class="pl-s1"><span class="pl-c">   */</span></span>
<span class="pl-s1">  <span class="pl-k">protected</span> <span class="pl-smi">$helloWorld</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">  <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">   * Initializes the servlet with the passed configuration.</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@param</span> \AppserverIo\Psr\Servlet\ServletConfigInterface $config</span></span>
<span class="pl-s1"><span class="pl-c">   *   The configuration to initialize the servlet with</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@return</span> void</span></span>
<span class="pl-s1"><span class="pl-c">   */</span></span>
<span class="pl-s1">  <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">init</span>(<span class="pl-c1">ServletConfigInterface</span> <span class="pl-smi">$config</span>)</span>
<span class="pl-s1">  {</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">// call parent method</span></span>
<span class="pl-s1">    <span class="pl-k">parent</span><span class="pl-k">::</span>init(<span class="pl-smi">$config</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">// prepare the text here</span></span>
<span class="pl-s1">    <span class="pl-smi">$this</span><span class="pl-k">-&gt;</span><span class="pl-smi">helloWorld</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Hello World!<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">// @todo Do all the bootstrapping here, because this method will</span></span>
<span class="pl-s1">    <span class="pl-c">//       be invoked only once when the Servlet Engines starts up</span></span>
<span class="pl-s1">  }</span>
<span class="pl-s1"></span>
<span class="pl-s1">  <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">   * Handles a HTTP GET request.</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@param</span> \AppserverIo\Psr\Servlet\Http\HttpServletRequestInterface  $servletRequest</span></span>
<span class="pl-s1"><span class="pl-c">   *   The request instance</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@param</span> \AppserverIo\Psr\Servlet\Http\HttpServletResponseInterface $servletResponse</span></span>
<span class="pl-s1"><span class="pl-c">   *   The response instance</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@return</span> void</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@see</span> \AppserverIo\Psr\Servlet\Http\HttpServlet::doGet()</span></span>
<span class="pl-s1"><span class="pl-c">   */</span></span>
<span class="pl-s1">  <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">doGet</span>(</span>
<span class="pl-s1">    <span class="pl-c1">HttpServletRequestInterface</span> <span class="pl-smi">$servletRequest</span>,</span>
<span class="pl-s1">    <span class="pl-c1">HttpServletResponseInterface</span> <span class="pl-smi">$servletResponse</span>)</span>
<span class="pl-s1">  {</span>
<span class="pl-s1">    <span class="pl-smi">$servletResponse</span><span class="pl-k">-&gt;</span>appendBodyStream(<span class="pl-smi">$this</span><span class="pl-k">-&gt;</span><span class="pl-smi">helloWorld</span>);</span>
<span class="pl-s1">  }</span>
<span class="pl-s1"></span>
<span class="pl-s1">  <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">   * Injects the session bean by its setter method.</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@param</span> \Namespace\Modulename\MyStatefulSessionBean $myStatefulSessionBean</span></span>
<span class="pl-s1"><span class="pl-c">   *   The instance to inject</span></span>
<span class="pl-s1"><span class="pl-c">   * @EnterpriseBean(name="MyStatefulSessionBean")</span></span>
<span class="pl-s1"><span class="pl-c">   */</span></span>
<span class="pl-s1">  <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">setMySessionBean</span>(<span class="pl-c1">MyStatefulSessionBean</span> <span class="pl-smi">$myStatefulSessionBean</span>)</span>
<span class="pl-s1">  {</span>
<span class="pl-s1">    <span class="pl-smi">$this</span><span class="pl-k">-&gt;</span><span class="pl-smi">myStatefulSessionBean</span> <span class="pl-k">=</span> <span class="pl-smi">$myStatefulSessionBean</span>;</span>
<span class="pl-s1">  }</span>
<span class="pl-s1">}</span></pre></div>

<blockquote>
<p>This method is the preferred one, because it will be refactored not to use reflection in further
versions.</p>
</blockquote>

<h1>
<a id="persistence-container" class="anchor" href="#persistence-container" aria-hidden="true"><span class="octicon octicon-link"></span></a>Persistence-Container</h1>

<p>As described in the introduction, the application is designed inside a runtime environment, like
an application server as appserver.io is. The following example gives you a short introduction
on how you can create a stateful session bean and the way you can invoke it's method on the client side.</p>

<p>First thing you can to do is create your SessionBean. What is a SessionBean? A SessionBean is basically a plain PHP class.
However, you MUST not instantiate it directly, because the application server takes care of its complete
lifecycle. Therefore, if you need an instance of a SessionBean, you must ask the application server
to give you an instance.</p>

<p>The persistence container will give you a proxy to the session bean that allows you to
invoke all methods the SessionBean provides, just like you would do with a normal instance. But,
the proxy also allows you to call this method over a network as remote method call. Using the
persistence container client makes it easy for you, if your SessionBean is on the same
application server instance or even on another appserver in your network. This gives you the possibility
to distribute the components of your application over your network, which means a great and
seamless scalability.</p>

<p>You have to tell the persistence container what type of SessionBean you would like to have. This MUST
be done by simply adding an annotation to the class doc block. The possible annotations therefore
are</p>

<ul>
<li><a href="https://github.com/Singleton" class="user-mention">@Singleton</a></li>
<li><a href="https://github.com/Stateless" class="user-mention">@Stateless</a></li>
<li><a href="https://github.com/Stateful" class="user-mention">@Stateful</a></li>
</ul>

<h2>
<a id="singleton-sessionbean" class="anchor" href="#singleton-sessionbean" aria-hidden="true"><span class="octicon octicon-link"></span></a><a href="https://github.com/Singleton" class="user-mention">@Singleton</a> SessionBean</h2>

<p>A SessionBean with a <a href="https://github.com/Singleton" class="user-mention">@Singleton</a> annotation will be created only one time for each application.
This means, whenever you'll request an instance, you'll receive the same one. If you set a
variable in the SessionBean, it'll be available until you'll overwrite it, or the application
server has been restarted.</p>

<h2>
<a id="stateless-sessionbean" class="anchor" href="#stateless-sessionbean" aria-hidden="true"><span class="octicon octicon-link"></span></a><a href="https://github.com/Stateless" class="user-mention">@Stateless</a> SessionBean</h2>

<p>Contrary to a singleton session bean, a SessionBean with a <a href="https://github.com/Stateless" class="user-mention">@Stateless</a> annotation will always
be instantiated, when you request it. It has NO state, and is only valid for the time you invoke a method on
it.</p>

<h2>
<a id="stateful-sessionbean" class="anchor" href="#stateful-sessionbean" aria-hidden="true"><span class="octicon octicon-link"></span></a><a href="https://github.com/Stateful" class="user-mention">@Stateful</a> SessionBean</h2>

<p>The <a href="https://github.com/Stateful" class="user-mention">@Stateful</a> SessionBean is a comprimise between the two other types. It is stateful for the session
with the ID you pass to the client, when you request the instance. A stateful SessionBean is
useful, for instance, if you want to implement something like a shopping cart. If you declare the shopping cart
instance, a class member of your SessionBean makes it persistent for your session lifetime.</p>

<h2>
<a id="example" class="anchor" href="#example" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example</h2>

<p>The following example shows you a really simple implementation of a stateful SessionBean providing
a counter that'll be raised whenever you call the <code>raiseMe()</code> method.</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">namespace</span> <span class="pl-en">Namespace\Module</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c"> * This is demo implementation of stateful session bean.</span></span>
<span class="pl-s1"><span class="pl-c"> *</span></span>
<span class="pl-s1"><span class="pl-c"> * @Stateful</span></span>
<span class="pl-s1"><span class="pl-c"> */</span></span>
<span class="pl-s1"><span class="pl-k">class</span> <span class="pl-en">MyStatefulSessionBean</span></span>
<span class="pl-s1">{</span>
<span class="pl-s1"></span>
<span class="pl-s1">  <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">   * Stateful counter that exists as long as your session exists.</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@var</span> integer</span></span>
<span class="pl-s1"><span class="pl-c">   */</span></span>
<span class="pl-s1">  <span class="pl-k">protected</span> <span class="pl-smi">$counter</span> <span class="pl-k">=</span> <span class="pl-c1">0</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">  <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">   * Example method that raises the counter by one each time you'll invoke it.</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@return</span> integer The raised counter</span></span>
<span class="pl-s1"><span class="pl-c">   */</span></span>
<span class="pl-s1">  <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">raiseMe</span>()</span>
<span class="pl-s1">  {</span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-smi">$this</span><span class="pl-k">-&gt;</span><span class="pl-smi">counter</span><span class="pl-k">++</span>;</span>
<span class="pl-s1">  }</span>
<span class="pl-s1">}</span></pre></div>

<p>Save the SessionBean in <code>/opt/appserver/myapp/META-INF/classes/Namespace/Module/MyStatefulSessionBean.php</code>.</p>

<p>As described above, you MUST not instantiate it directly. To request an instance of the SessionBean
you MUST use the persistence container client. With the <code>lookup()</code> method you'll receive a proxy to
your SessionBean, on that you can invoke the methods as you can do with a real instance.</p>

<p>To develop our HelloWorldServlet further, let's raise the counter with each request to the servlet. To
do this, we have to refactor the <code>doGet()</code> method</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">namespace</span> <span class="pl-en">Namespace\Module</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">AppserverIo\Psr\Servlet\ServletConfigInterface</span>;</span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">AppserverIo\Psr\Servlet\Http\HttpServlet</span>;</span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">AppserverIo\Psr\Servlet\Http\HttpServletRequestInterface</span>;</span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">AppserverIo\Psr\Servlet\Http\HttpServletResponseInterface</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c"> * This is the famous 'Hello World' as servlet implementation.</span></span>
<span class="pl-s1"><span class="pl-c"> */</span></span>
<span class="pl-s1"><span class="pl-k">class</span> <span class="pl-en">HelloWorldServlet</span> <span class="pl-k">extends</span> <span class="pl-e">HttpServlet</span></span>
<span class="pl-s1">{</span>
<span class="pl-s1"></span>
<span class="pl-s1">  <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">   * The text to be rendered.</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@var</span> string</span></span>
<span class="pl-s1"><span class="pl-c">   */</span></span>
<span class="pl-s1">  <span class="pl-k">protected</span> <span class="pl-smi">$helloWorld</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">  <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">   * We want to have an instance of our stateful session bean injected.</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@var</span> \Namespace\Module\MyStatefulSessionBean</span></span>
<span class="pl-s1"><span class="pl-c">   */</span></span>
<span class="pl-s1">   <span class="pl-k">protected</span> <span class="pl-smi">$myStatefulSessionBean</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">  <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">   * Initializes the servlet with the passed configuration.</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@param</span> \AppserverIo\Psr\Servlet\ServletConfigInterface $config</span></span>
<span class="pl-s1"><span class="pl-c">   *   The configuration to initialize the servlet with</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@return</span> void</span></span>
<span class="pl-s1"><span class="pl-c">   */</span></span>
<span class="pl-s1">  <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">init</span>(<span class="pl-c1">ServletConfigInterface</span> <span class="pl-smi">$config</span>)</span>
<span class="pl-s1">  {</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">// call parent method</span></span>
<span class="pl-s1">    <span class="pl-k">parent</span><span class="pl-k">::</span>init(<span class="pl-smi">$config</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">// prepare the text here</span></span>
<span class="pl-s1">    <span class="pl-smi">$this</span><span class="pl-k">-&gt;</span><span class="pl-smi">helloWorld</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Hello World! (has been invoked %d times)<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">// @todo Do all the bootstrapping here, because this method will</span></span>
<span class="pl-s1">    <span class="pl-c">//       be invoked only once when the Servlet Engines starts up</span></span>
<span class="pl-s1">  }</span>
<span class="pl-s1"></span>
<span class="pl-s1">  <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">   * Handles a HTTP GET request.</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@param</span> \AppserverIo\Psr\Servlet\Http\HttpServletRequestInterface  $servletRequest</span></span>
<span class="pl-s1"><span class="pl-c">   *   The request instance</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@param</span> \AppserverIo\Psr\Servlet\Http\HttpServletResponseInterface $servletResponse</span></span>
<span class="pl-s1"><span class="pl-c">   *   The response instance</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@return</span> void</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@see</span> \AppserverIo\Psr\Servlet\Http\HttpServlet::doGet()</span></span>
<span class="pl-s1"><span class="pl-c">   */</span></span>
<span class="pl-s1">  <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">doGet</span>(</span>
<span class="pl-s1">    <span class="pl-c1">HttpServletRequestInterface</span> <span class="pl-smi">$servletRequest</span>,</span>
<span class="pl-s1">    <span class="pl-c1">HttpServletResponseInterface</span> <span class="pl-smi">$servletResponse</span>)</span>
<span class="pl-s1">  {</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">// start a session, because our @Stateful SessionBean</span></span>
<span class="pl-s1">    <span class="pl-c">// needs thesession-ID to bound to</span></span>
<span class="pl-s1">    <span class="pl-smi">$servletRequest</span><span class="pl-k">-&gt;</span>getSession()<span class="pl-k">-&gt;</span>start(<span class="pl-c1">true</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">// render 'Hello World! (has been invoked 1 times)'</span></span>
<span class="pl-s1">    <span class="pl-c">// for example - after the first request</span></span>
<span class="pl-s1">    <span class="pl-smi">$servletResponse</span><span class="pl-k">-&gt;</span>appendBodyStream(</span>
<span class="pl-s1">      <span class="pl-c1">sprintf</span>(<span class="pl-smi">$this</span><span class="pl-k">-&gt;</span><span class="pl-smi">helloWorld</span>, <span class="pl-smi">$this</span><span class="pl-k">-&gt;</span><span class="pl-smi">myStatefulSessionBean</span><span class="pl-k">-&gt;</span>raiseMe())</span>
<span class="pl-s1">    );</span>
<span class="pl-s1">  }</span>
<span class="pl-s1"></span>
<span class="pl-s1">  <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">   * Injects the session bean by its setter method.</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@param</span> \Namespace\Modulename\MyStatefulSessionBean $myStatefulSessionBean</span></span>
<span class="pl-s1"><span class="pl-c">   *   The instance to inject</span></span>
<span class="pl-s1"><span class="pl-c">   * @EnterpriseBean(name="MyStatefulSessionBean")</span></span>
<span class="pl-s1"><span class="pl-c">   */</span></span>
<span class="pl-s1">  <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">setMySessionBean</span>(<span class="pl-c1">MyStatefulSessionBean</span> <span class="pl-smi">$myStatefulSessionBean</span>)</span>
<span class="pl-s1">  {</span>
<span class="pl-s1">    <span class="pl-smi">$this</span><span class="pl-k">-&gt;</span><span class="pl-smi">myStatefulSessionBean</span> <span class="pl-k">=</span> <span class="pl-smi">$myStatefulSessionBean</span>;</span>
<span class="pl-s1">  }</span>
<span class="pl-s1">}</span></pre></div>

<p>That's it!</p>

<blockquote>
<p>As we use a <a href="https://github.com/Stateful" class="user-mention">@Stateful</a> SessionBean in this example, we MUST start a session so the persistence container can
bind the SessionBean. If you would have used a <a href="https://github.com/Singleton" class="user-mention">@Singleton</a> SessionBean, the effect would be the
practically the same, but it would have been possible to start a SessionBean per session. As a consequence, each Servlet that
invokes the <code>raiseMe()</code> method on the singleton SessionBean would raise the counter, meaning possibly every call to the server would raise the counter and not each particular call for a particular session.</p>
</blockquote>

<h1>
<a id="message-queue" class="anchor" href="#message-queue" aria-hidden="true"><span class="octicon octicon-link"></span></a>Message-Queue</h1>

<p>A Message-Queue provides the possibility to process long running tasks in an encapsulated context.
For example, if you want to import a lot of products in your online shop, you can send a
message to the Message-Queue, which then will start the import process in the background without
preventing the calling process to continue.</p>

<blockquote>
<p>Using a Message-Queue gives you the power to use threads without taking care of the pitfalls!</p>
</blockquote>

<h2>
<a id="got-mail" class="anchor" href="#got-mail" aria-hidden="true"><span class="octicon octicon-link"></span></a>Got mail!</h2>

<p>Before we can send a message, we have to specify what should happen, when we receive one! The
Message-Queue allows you to specify so called <code>Queues</code>. Each <code>Queue</code> can have a receiver, which
must be a so called <code>MessageBean</code>. A <code>MessageBean</code> is very similar to a <a href="#@stateless-session-bean">@Stateless SessionBean</a>,
but has only a single point of entry, the <code>onMessage()</code> message method. Whenever a message
is sent to the queue, the Message-Queue simply pushes it onto the stack. In the background, a
<code>QueueWorker</code> is running in another context and queries the stack for new messages. If a new
message is available, it will be pulled from the stack, as a new instance of the receiver, which the <code>Queue</code>
is bound to and will be instantiated to pass the message for processing.</p>

<p>So let us create a simple <code>Queue</code> with</p>

<div class="highlight highlight-text-xml"><pre>&lt;?<span class="pl-ent">xml</span><span class="pl-e"> version</span>=<span class="pl-s"><span class="pl-pds">"</span>1.0<span class="pl-pds">"</span></span><span class="pl-e"> encoding</span>=<span class="pl-s"><span class="pl-pds">"</span>UTF-8<span class="pl-pds">"</span></span>?&gt;
&lt;<span class="pl-ent">message-queues</span>&gt;
  &lt;<span class="pl-ent">message-queue</span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>ImportReceiver<span class="pl-pds">"</span></span>&gt;
    &lt;<span class="pl-ent">destination</span>&gt;pms/import&lt;/<span class="pl-ent">destination</span>&gt;
  &lt;/<span class="pl-ent">message-queue</span>&gt;
&lt;/<span class="pl-ent">message-queues</span>&gt;</pre></div>

<p>and save this in a file called <code>/opt/appserver/myapp/META-INF/message-queues.xml</code>. The next thing
we need is the <code>MessageBean</code> that allows us to receive and process a message in a separate thread.</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">namespace</span> <span class="pl-en">Namespace\Modulename</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">AppserverIo\Appserver\MessageQueue\Receiver\AbstractReceiver</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c"> * @MessageDriven</span></span>
<span class="pl-s1"><span class="pl-c"> */</span></span>
<span class="pl-s1"><span class="pl-k">class</span> <span class="pl-en">ImportReceiver</span> <span class="pl-k">extends</span> <span class="pl-e">AbstractReceiver</span></span>
<span class="pl-s1">{</span>
<span class="pl-s1"></span>
<span class="pl-s1">  <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">   * Will be invoked when a new message for this message bean will be available.</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@param</span> \AppserverIo\Psr\MessageQueueProtocol\Message $message   A message this message bean is listen for</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@param</span> string                                        $sessionId The session ID</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@return</span> void</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@see</span> \AppserverIo\Psr\MessageQueueProtocol\Receiver::onMessage()</span></span>
<span class="pl-s1"><span class="pl-c">   */</span></span>
<span class="pl-s1">  <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">onMessage</span>(<span class="pl-c1">Message</span> <span class="pl-smi">$message</span>, <span class="pl-smi">$sessionId</span>)</span>
<span class="pl-s1">  {</span>
<span class="pl-s1">    <span class="pl-smi">$data</span> <span class="pl-k">=</span> <span class="pl-c1">array_map</span>(<span class="pl-s"><span class="pl-pds">'</span>str_getcsv<span class="pl-pds">'</span></span>, <span class="pl-c1">file</span>(<span class="pl-smi">$message</span><span class="pl-k">-&gt;</span>getMessage()<span class="pl-k">-&gt;</span>__toString()));</span>
<span class="pl-s1">    <span class="pl-k">foreach</span> (<span class="pl-smi">$data</span> <span class="pl-k">as</span> <span class="pl-smi">$row</span>) {</span>
<span class="pl-s1">      <span class="pl-c">// write the data to the database here</span></span>
<span class="pl-s1">    }</span>
<span class="pl-s1">  }</span>
<span class="pl-s1">}</span></pre></div>

<blockquote>
<p>Please note: beside the functionality you have to implement with the <code>onMessage()</code>
message method, you must also use the annotation <code>@MessageDriven</code> on your class. You MUST annotate the MessageBean in this fashion,
in order for the container to know about and register it on startup.</p>
</blockquote>

<p>Pretty simple for running your import in a separate thread? But what about sending a message to
this <code>Queue</code>?</p>

<h2>
<a id="send-a-message" class="anchor" href="#send-a-message" aria-hidden="true"><span class="octicon octicon-link"></span></a>Send a message</h2>

<p>Messages are POPOs (Plain Old PHP Objects) that can be sent over the network. So if you want to send a message, you have
to initialize the Message-Queue Client and specify which <code>Queue</code> you want to send the message to.</p>

<p>Again, we will extend our <code>Servlet</code> to start an import process on a POST request</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">namespace</span> <span class="pl-en">Namespace\Module</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">AppserverIo\Psr\Servlet\ServletConfigInterface</span>;</span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">AppserverIo\Psr\Servlet\Http\HttpServlet</span>;</span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">AppserverIo\Psr\Servlet\Http\HttpServletRequestInterface</span>;</span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">AppserverIo\Psr\Servlet\Http\HttpServletResponseInterface</span>;</span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">AppserverIo\Psr\MessageQueueProtocol\Messages\StringMessage</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c"> * This is the famous 'Hello World' as servlet implementation.</span></span>
<span class="pl-s1"><span class="pl-c"> */</span></span>
<span class="pl-s1"><span class="pl-k">class</span> <span class="pl-en">HelloWorldServlet</span> <span class="pl-k">extends</span> <span class="pl-e">HttpServlet</span></span>
<span class="pl-s1">{</span>
<span class="pl-s1"></span>
<span class="pl-s1">  <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">   * The name of the request parameter with the name of the CSV</span></span>
<span class="pl-s1"><span class="pl-c">   * file containing the data to be imported.</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@var</span> string</span></span>
<span class="pl-s1"><span class="pl-c">   */</span></span>
<span class="pl-s1">  <span class="pl-k">const</span> <span class="pl-c1">PARAMETER_FILENAME</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>filename<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">  <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">   * The text to be rendered.</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@var</span> string</span></span>
<span class="pl-s1"><span class="pl-c">   */</span></span>
<span class="pl-s1">  <span class="pl-k">protected</span> <span class="pl-smi">$helloWorld</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">  <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">   * We want to have an instance of our stateful session bean injected.</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@var</span> \Namespace\Module\MyStatefulSessionBean</span></span>
<span class="pl-s1"><span class="pl-c">   */</span></span>
<span class="pl-s1">   <span class="pl-k">protected</span> <span class="pl-smi">$myStatefulSessionBean</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">  <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">   * The application instance.</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@var</span> \AppserverIo\Psr\Application\ApplicationInterface</span></span>
<span class="pl-s1"><span class="pl-c">   */</span></span>
<span class="pl-s1">  <span class="pl-k">protected</span> <span class="pl-smi">$application</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">  <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">   * The queue session to send a message with.</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@var</span> \AppserverIo\MessageQueueClient\QueueSession</span></span>
<span class="pl-s1"><span class="pl-c">   * @Resource(name="pms/import")</span></span>
<span class="pl-s1"><span class="pl-c">   */</span></span>
<span class="pl-s1">  <span class="pl-k">protected</span> <span class="pl-smi">$queueSender</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">  <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">   * Initializes the servlet with the passed configuration.</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@param</span> \AppserverIo\Psr\Servlet\ServletConfigInterface $config</span></span>
<span class="pl-s1"><span class="pl-c">   *   The configuration to initialize the servlet with</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@return</span> void</span></span>
<span class="pl-s1"><span class="pl-c">   */</span></span>
<span class="pl-s1">  <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">init</span>(<span class="pl-c1">ServletConfigInterface</span> <span class="pl-smi">$config</span>)</span>
<span class="pl-s1">  {</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">// call parent method</span></span>
<span class="pl-s1">    <span class="pl-k">parent</span><span class="pl-k">::</span>init(<span class="pl-smi">$config</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">// prepare the text here</span></span>
<span class="pl-s1">    <span class="pl-smi">$this</span><span class="pl-k">-&gt;</span><span class="pl-smi">helloWorld</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Hello World! (has been invoked %d times)<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">// @todo Do all the bootstrapping here, because this method will</span></span>
<span class="pl-s1">    <span class="pl-c">//       be invoked only once when the Servlet Engines starts up</span></span>
<span class="pl-s1">  }</span>
<span class="pl-s1"></span>
<span class="pl-s1">  <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">   * Handles a HTTP GET request.</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@param</span> \AppserverIo\Psr\Servlet\Http\HttpServletRequestInterface  $servletRequest</span></span>
<span class="pl-s1"><span class="pl-c">   *   The request instance</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@param</span> \AppserverIo\Psr\Servlet\Http\HttpServletResponseInterface $servletResponse</span></span>
<span class="pl-s1"><span class="pl-c">   *   The response instance</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@return</span> void</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@see</span> \AppserverIo\Psr\Servlet\Http\HttpServlet::doGet()</span></span>
<span class="pl-s1"><span class="pl-c">   */</span></span>
<span class="pl-s1">  <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">doGet</span>(</span>
<span class="pl-s1">    <span class="pl-c1">HttpServletRequestInterface</span> <span class="pl-smi">$servletRequest</span>,</span>
<span class="pl-s1">    <span class="pl-c1">HttpServletResponseInterface</span> <span class="pl-smi">$servletResponse</span>)</span>
<span class="pl-s1">  {</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">// start a session, because our @Stateful SessionBean</span></span>
<span class="pl-s1">    <span class="pl-c">// needs thesession-ID to bound to</span></span>
<span class="pl-s1">    <span class="pl-smi">$servletRequest</span><span class="pl-k">-&gt;</span>getSession()<span class="pl-k">-&gt;</span>start(<span class="pl-c1">true</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">// render 'Hello World! (has been invoked 1 times)'</span></span>
<span class="pl-s1">    <span class="pl-c">// for example - after the first request</span></span>
<span class="pl-s1">    <span class="pl-smi">$servletResponse</span><span class="pl-k">-&gt;</span>appendBodyStream(</span>
<span class="pl-s1">      <span class="pl-c1">sprintf</span>(<span class="pl-smi">$this</span><span class="pl-k">-&gt;</span><span class="pl-smi">helloWorld</span>, <span class="pl-smi">$this</span><span class="pl-k">-&gt;</span><span class="pl-smi">myStatefulSessionBean</span><span class="pl-k">-&gt;</span>raiseMe())</span>
<span class="pl-s1">    );</span>
<span class="pl-s1">  }</span>
<span class="pl-s1"></span>
<span class="pl-s1">  <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">   * Handles a HTTP POST request.</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * Loads the filename containing the CSV data we want to import as request</span></span>
<span class="pl-s1"><span class="pl-c">   * parameter and sends it, wrapped as message, to the queue.</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@param</span> \AppserverIo\Psr\Servlet\Http\ServletRequest  $servletRequest</span></span>
<span class="pl-s1"><span class="pl-c">   *   The request instance</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@param</span> \AppserverIo\Psr\Servlet\Http\ServletResponse $servletResponse</span></span>
<span class="pl-s1"><span class="pl-c">   *   The response instance</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@return</span> void</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@see</span> \AppserverIo\Psr\Servlet\Http\HttpServlet::doPost()</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@throws</span> \AppserverIo\Psr\Servlet\ServletException</span></span>
<span class="pl-s1"><span class="pl-c">   *   Is thrown because the request method is not implemented yet</span></span>
<span class="pl-s1"><span class="pl-c">   */</span></span>
<span class="pl-s1">  <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">doPost</span>(</span>
<span class="pl-s1">    <span class="pl-c1">HttpServletRequestInterface</span> <span class="pl-smi">$servletRequest</span>,</span>
<span class="pl-s1">    <span class="pl-c1">HttpServletResponseInterface</span> <span class="pl-smi">$servletResponse</span>)</span>
<span class="pl-s1">  {</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">// load the filename we have to import</span></span>
<span class="pl-s1">    <span class="pl-smi">$filename</span> <span class="pl-k">=</span> <span class="pl-smi">$servletRequest</span><span class="pl-k">-&gt;</span>getParameter(</span>
<span class="pl-s1">      <span class="pl-c1">HelloWorldServlet</span><span class="pl-k">::</span><span class="pl-c1">PARAMETER_FILENAME</span></span>
<span class="pl-s1">    );</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">// send the name of the file to import to the message queue</span></span>
<span class="pl-s1">    <span class="pl-smi">$this</span><span class="pl-k">-&gt;</span><span class="pl-smi">queueSender</span><span class="pl-k">-&gt;</span>send(<span class="pl-k">new</span> <span class="pl-c1">StringMessage</span>(<span class="pl-smi">$filename</span>), <span class="pl-c1">false</span>);</span>
<span class="pl-s1">  }</span>
<span class="pl-s1"></span>
<span class="pl-s1">  <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">   * Injects the session bean by its setter method.</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@param</span> \Namespace\Modulename\MyStatefulSessionBean $myStatefulSessionBean</span></span>
<span class="pl-s1"><span class="pl-c">   *   The instance to inject</span></span>
<span class="pl-s1"><span class="pl-c">   * @EnterpriseBean(name="MyStatefulSessionBean")</span></span>
<span class="pl-s1"><span class="pl-c">   */</span></span>
<span class="pl-s1">  <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">setMySessionBean</span>(<span class="pl-c1">MyStatefulSessionBean</span> <span class="pl-smi">$myStatefulSessionBean</span>)</span>
<span class="pl-s1">  {</span>
<span class="pl-s1">    <span class="pl-smi">$this</span><span class="pl-k">-&gt;</span><span class="pl-smi">myStatefulSessionBean</span> <span class="pl-k">=</span> <span class="pl-smi">$myStatefulSessionBean</span>;</span>
<span class="pl-s1">  }</span>
<span class="pl-s1"></span>
<span class="pl-s1">  <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">   * Injects the application instance by its setter method.</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@param</span> \AppserverIo\Psr\Application\ApplicationInterface $application</span></span>
<span class="pl-s1"><span class="pl-c">   *   The application instance to inject</span></span>
<span class="pl-s1"><span class="pl-c">   * @Resource(name="ApplicationInterface")</span></span>
<span class="pl-s1"><span class="pl-c">   */</span></span>
<span class="pl-s1">  <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">setApplication</span>(<span class="pl-c1">ApplicationInterface</span> <span class="pl-smi">$application</span>)</span>
<span class="pl-s1">  {</span>
<span class="pl-s1">    <span class="pl-smi">$this</span><span class="pl-k">-&gt;</span><span class="pl-smi">application</span> <span class="pl-k">=</span> <span class="pl-smi">$application</span>;</span>
<span class="pl-s1">  }</span>
<span class="pl-s1">}</span></pre></div>

<blockquote>
<p>To make the process easier, you can use the <code>@Resource</code> annotation to let the container inject a sender
instance, which we can use to send the name of the file containing the data to the <code>Queue</code>.</p>
</blockquote>

<h1>
<a id="timer-service" class="anchor" href="#timer-service" aria-hidden="true"><span class="octicon octicon-link"></span></a>Timer-Service</h1>

<p>In most of your projects you have the need to schedule tasks to be processed at regular intervals
or at a given dates in the future. As PHP itself is a scripting language, it lacks such functionality
and developers usually end up using utilities like CRON, when working on Mac OS X or a Linux distribution, which also requires low level access to the server. And, if you
are working on Windows, it's even a bit more complicated. There is a tool called Scheduler in Windows, but
using it is not as simple to as CRON. Neither of these options are really "programmable" and this is where a Timer Service comes into the game and makes scheduling tasks within your appserver application a dream come true..</p>

<p>As CRON does, the Timer Service allows you to schedule processing of your functional tasks at a given
date or in regular intervals. In contrast to CRON however, it allows you to schedule processing the methods
of your Beans (which remember, are already processed and stored in memory).</p>

<p>How can this be done?</p>

<p>You might know the answer by now, simply by adding an annotation to your method, as follows</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">namespace</span> <span class="pl-en">Namespace\Modulename</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c"> * @Singleton(name="ASingletonProcessor")</span></span>
<span class="pl-s1"><span class="pl-c"> */</span></span>
<span class="pl-s1"><span class="pl-k">class</span> <span class="pl-en">ASingletonProcessor</span> <span class="pl-k">extends</span> <span class="pl-c1">\</span><span class="pl-e">Stackable</span></span>
<span class="pl-s1">{</span>
<span class="pl-s1"></span>
<span class="pl-s1">  <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">   * A dummy method invoked by the container upon timer schedule.</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@param</span> TimerInterface $timer The timer instance</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@return</span> void</span></span>
<span class="pl-s1"><span class="pl-c">   * @Schedule(dayOfMonth=EVERY, month=EVERY, year=EVERY, minute=EVERY, hour=EVERY)</span></span>
<span class="pl-s1"><span class="pl-c">   */</span></span>
<span class="pl-s1">  <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">invokedByTimer</span>(<span class="pl-c1">TimerInterface</span> <span class="pl-smi">$timer</span>)</span>
<span class="pl-s1">  {</span>
<span class="pl-s1">    <span class="pl-c">// do something here every minute</span></span>
<span class="pl-s1">  }</span>
<span class="pl-s1">}</span></pre></div>

<p>The <code>@Schedule</code> annotation on the <code>invokedByTimer()</code> method schedules the invocation of this
method every minute without the need to have a CRON configured or running. Such <code>Timers</code> can
also be created programatically. If you want to know more about this functionality, have a look at our <a href="https://github.com/appserver-io-apps/example">example</a>.</p>

<h1>
<a id="aop" class="anchor" href="#aop" aria-hidden="true"><span class="octicon octicon-link"></span></a>AOP</h1>

<p>Although in its early days, AOP used to be a buzzword. It has, however, become a development paradigm followed by many of the PHP frameworks out there today. It has been followed for many years already by other languages like Java. Since there is actually no stable PECL extension, nor is AOP part of the PHP core, creating such an environment creates a number of challenges to make applications based on AOP to perform well. Because of its nature, AOP needs to be deeply weaved into your code. Most of the solutions available for PHP solve that by generating so called <code>proxy classes</code> that wrap the original methods and allow to weave the advices before, after or around the original implementation.</p>

<p>Since in appserver, we're in a multi-threaded environment and performance is one of our main goals, we were not
able to use anyone one of the available solutions. As we also need to generate proxy classes, we decided
to do that through an autoloader. And since we have enabled an autoloader as part of the appserver.io distribution, you
don't have to configure anything to use AOP in your code.</p>

<h2>
<a id="how-to-add-an-advice" class="anchor" href="#how-to-add-an-advice" aria-hidden="true"><span class="octicon octicon-link"></span></a>How to add an Advice</h2>

<p>Integrating AOP in your app can be done in two ways. The first one is to define the pointcuts (and also
advices if you like) in the same class they will get woven into, the second method is to separate them. In the following section we want to describe the second approach.</p>

<p>Let's say we want to log all GET requests on our HelloWorldServlet without adding any
code to the servlet itself. To do this, we first have to create an Aspect class like</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">namespace</span> <span class="pl-en">Namespace\Module</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c"> * @Aspect</span></span>
<span class="pl-s1"><span class="pl-c"> */</span></span>
<span class="pl-s1"><span class="pl-k">class</span> <span class="pl-en">LoggerAspect</span></span>
<span class="pl-s1">{</span>
<span class="pl-s1"></span>
<span class="pl-s1">  <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">   * Pointcut which targets all GET requests for all servlets</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@return</span> void</span></span>
<span class="pl-s1"><span class="pl-c">   * @Pointcut("call(\Namespace\Module\*-&gt;doGet())")</span></span>
<span class="pl-s1"><span class="pl-c">   */</span></span>
<span class="pl-s1">  <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">allDoGet</span>()</span>
<span class="pl-s1">  {</span>
<span class="pl-s1">  }</span>
<span class="pl-s1"></span>
<span class="pl-s1">  <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">   * Advice used to log the call to any advised method.</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@param</span> \AppserverIo\Doppelgaenger\Interfaces\MethodInvocationInterface $methodInvocation</span></span>
<span class="pl-s1"><span class="pl-c">   *   Initially invoked method</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@return</span> null</span></span>
<span class="pl-s1"><span class="pl-c">   * @Before("pointcut(allIndexActions())")</span></span>
<span class="pl-s1"><span class="pl-c">   */</span></span>
<span class="pl-s1">  <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">logInfoAdvice</span>(<span class="pl-c1">MethodInvocationInterface</span> <span class="pl-smi">$methodInvocation</span>)</span>
<span class="pl-s1">  {</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">// load class and method name</span></span>
<span class="pl-s1">    <span class="pl-smi">$className</span> <span class="pl-k">=</span> <span class="pl-smi">$methodInvocation</span><span class="pl-k">-&gt;</span>getStructureName();</span>
<span class="pl-s1">    <span class="pl-smi">$methodName</span> <span class="pl-k">=</span> <span class="pl-smi">$methodInvocation</span><span class="pl-k">-&gt;</span>getName()</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">// log the method invocation</span></span>
<span class="pl-s1">    <span class="pl-smi">$methodInvocation</span><span class="pl-k">-&gt;</span>getContext()</span>
<span class="pl-s1">      <span class="pl-k">-&gt;</span>getServletRequest()</span>
<span class="pl-s1">      <span class="pl-k">-&gt;</span>getContext()</span>
<span class="pl-s1">      <span class="pl-k">-&gt;</span>getInitialContext()</span>
<span class="pl-s1">      <span class="pl-k">-&gt;</span>getSystemLogger()</span>
<span class="pl-s1">      <span class="pl-k">-&gt;</span>info(</span>
<span class="pl-s1">        <span class="pl-c1">sprintf</span>(<span class="pl-s"><span class="pl-pds">'</span>The method %s::%s is about to be called<span class="pl-pds">'</span></span>, <span class="pl-c1">className</span>, <span class="pl-c1">methodName</span>)</span>
<span class="pl-s1">      );</span>
<span class="pl-s1">  }</span>
<span class="pl-s1">}</span></pre></div>

<p>Store the class in <code>/opt/appserver/myapp/META-INF/classes/Namespace/Module/LoggerAspect</code> and
<a href="#start-and-stop-scripts">restart</a> the application server.</p>

<p>To see the the log message, open the console (Linux/Mac OS X) and enter</p>

<div class="highlight highlight-source-shell"><pre>$ tail -f /opt/appserver/var/log/appserver-errors.log</pre></div>

<p>Then open <code>http://127.0.0.1:9080/myapp/helloWorld.do</code> in your favorite browser, and have a look
at the console.</p>

<blockquote>
<p>AOP is a very powerful instrument to enrich your application with functionality with "controlled" coupling.
But as in most cases, great power comes with great responsibility. So, it is really
necessary to keep in mind, where your Aspect classes are and what they do. If not, someone
will wonder what happens and may need a good amount of time to figure out a problem. To avoid this, we'll
provide an XML based advice declaration in future versions.</p>
</blockquote>

<h1>
<a id="design-by-contract" class="anchor" href="#design-by-contract" aria-hidden="true"><span class="octicon octicon-link"></span></a>Design-by-Contract</h1>

<p>Beside AOP, <a href="http://en.wikipedia.org/wiki/Design_by_contract">Design-by-Contract</a> is another
interesting approach we support out-of-the-box, when you think about the architecture of your
software.</p>

<p>First introduced by Bertrand Meyer in connection with his design of the Eiffel programming language,
Design-by-Contract allows you to define formal, precise and verifiable interface specifications of
software components.</p>

<p>Design-by-Contract extends the ordinary definition of classes, abstract classes and interfaces by
adding pre-/postconditions and invariants referred to as <code>contracts</code>. As Design-by-Contract is, as
is AOP, not part of the PHP core, we also use annotations to specify these contracts.</p>

<h2>
<a id="what-can-be-done" class="anchor" href="#what-can-be-done" aria-hidden="true"><span class="octicon octicon-link"></span></a>What can be done?</h2>

<p>As stated above, this library aims to bring you the power of Design by Contract, an approach to make
your applications more robust and easier to debug. This contains basic features as:</p>

<ul>
<li>Use your basic <code>DocBlock</code> annotations <code>@param</code> and <code>@return</code> as type hints (scalar and class/interface
based), including special features like <code>typed arrays</code> using e. g. <code>array&lt;int&gt;</code> (currently only works for collections with complex types)</li>
<li>Specify complex method contracts in PHP syntax using <code>@requires</code> as precondition and <code>@ensures</code> as
postcondition</li>
<li>Specify a state of validity for your classes (e.g. <code>$this-&gt;attribute !== null</code>) which will be true
all times using <code>@invariant</code>
</li>
<li>The above (not including type safety) will be inherited by every child structure, strengthening your
object hierarchies</li>
<li>The library will warn you (exception or log message) on violations of these contracts</li>
</ul>

<h2>
<a id="how-does-it-work" class="anchor" href="#how-does-it-work" aria-hidden="true"><span class="octicon octicon-link"></span></a>How does it work?</h2>

<p>We use a system of autoloading and code creation to ensure our annotations will be enforced.
This features a 4 step process:</p>

<ul>
<li>Autoloader : Handles autoloading and will know if contract enforcement is needed for a certain file.
If so (and the cache is empty) the call will be directed to the Generator/Parser Combo</li>
<li>Parser : Will parse the needed file using <a href="http://www.php.net/manual/en/book.tokenizer.php"><code>Tokenizer</code></a>
and provide information for further handling.</li>
<li>Generator : Will use stream filters to create a new file structure definition containing configured enforcement</li>
<li>Cache : Will allow us to omit Parser and Generator for future calls, to speed up usage significantly.</li>
</ul>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>Supposed, we want to make sure, that the counter in our stateful SessionBean will always be an integer, we can
define a simple contract, therefore</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">namespace</span> <span class="pl-en">Namespace\Module</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c"> * This is demo implementation of stateful session bean.</span></span>
<span class="pl-s1"><span class="pl-c"> *</span></span>
<span class="pl-s1"><span class="pl-c"> * @Stateful</span></span>
<span class="pl-s1"><span class="pl-c"> * @invariant is_integer($this-&gt;counter)</span></span>
<span class="pl-s1"><span class="pl-c"> */</span></span>
<span class="pl-s1"><span class="pl-k">class</span> <span class="pl-en">MyStatefulSessionBean</span></span>
<span class="pl-s1">{</span>
<span class="pl-s1"></span>
<span class="pl-s1">  <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">   * Stateful counter that exists as long as your session exists.</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@var</span> integer</span></span>
<span class="pl-s1"><span class="pl-c">   */</span></span>
<span class="pl-s1">  <span class="pl-k">protected</span> <span class="pl-smi">$counter</span> <span class="pl-k">=</span> <span class="pl-c1">0</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">  <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">   * Example method that raises the counter by one each time you'll invoke it.</span></span>
<span class="pl-s1"><span class="pl-c">   *</span></span>
<span class="pl-s1"><span class="pl-c">   * <span class="pl-k">@return</span> integer The raised counter</span></span>
<span class="pl-s1"><span class="pl-c">   */</span></span>
<span class="pl-s1">  <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">raiseMe</span>()</span>
<span class="pl-s1">  {</span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-smi">$this</span><span class="pl-k">-&gt;</span><span class="pl-smi">counter</span><span class="pl-k">++</span>;</span>
<span class="pl-s1">  }</span>
<span class="pl-s1">}</span></pre></div>

<p>Depending on your configuration, if a method would try to set a string on the counter variable, the
Design-by-Contract implementation would either throw an exception or write an error message to our
log file under <code>/opt/appserver/var/log/appserver-errors.log</code>.</p>

<h1>
<a id="runtime-environment" class="anchor" href="#runtime-environment" aria-hidden="true"><span class="octicon octicon-link"></span></a>Runtime Environment</h1>

<p>The appserver.io runtime environment is delivered by the package <a href="https://github.com/appserver-io-php/runtime">runtime</a>.
This package  provides a runtime which is system independent and encloses a thread-safe
compiled PHP environment. Besides the most recent PHP 5.5.x version the package comes with following installed
extensions:</p>

<ul>
<li><a href="http://github.com/appserver-io-php/pthreads">pthreads</a></li>
<li>
<a href="https://github.com/appserver-io/php-ext-appserver">appserver</a> (contains some replacement functions
which behave badly in a multi-threaded environment)</li>
</ul>

<p>Additionally, the PECL extensions <a href="http://pecl.php.net/package/xdebug">XDebug</a> and <a href="http://pecl.php.net/package/ev">ev</a>
are compiled as shared modules. <code>XDebug</code> is necessary to render detailed code coverage reports when
running unit and integration tests. <code>ev</code> will be used to integrate a timer service in one of the future
versions.</p>

<h1>
<a id="configuration" class="anchor" href="#configuration" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuration</h1>

<p>We believe that the appserver should be highly configurable, so anyone interested can fiddle
around with it. Therefore, we provide a central configuration file located at <code>/opt/appserver/etc/appserver.xml</code>.</p>

<p>This file contains the complete <a href="#the-architecture">architecture</a> as an XML structure.</p>

<p>So if you want to change used components, introduce new services or scale the system by adding
additional servers you can do so with some lines of XML.You might have a look at a basic
<code>appserver.xml</code>.</p>

<h2>
<a id="the-architecture" class="anchor" href="#the-architecture" aria-hidden="true"><span class="octicon octicon-link"></span></a>The Architecture</h2>

<p>In this example we have a shortened piece of the <code>appserver.xml</code> file to understand how the
architecture is driven by configuration.</p>

<div class="highlight highlight-text-xml"><pre>&lt;?<span class="pl-ent">xml</span><span class="pl-e"> version</span>=<span class="pl-s"><span class="pl-pds">"</span>1.0<span class="pl-pds">"</span></span><span class="pl-e"> encoding</span>=<span class="pl-s"><span class="pl-pds">"</span>UTF-8<span class="pl-pds">"</span></span>?&gt;
&lt;<span class="pl-ent">appserver</span> <span class="pl-e">xmlns</span>=<span class="pl-s"><span class="pl-pds">"</span>http://www.appserver.io/appserver<span class="pl-pds">"</span></span>&gt;

  <span class="pl-c">&lt;!-- define user, group and default umask applied when creating directories and files --&gt;</span>
  &lt;<span class="pl-ent">params</span>&gt;
    &lt;<span class="pl-ent">param</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>user<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span>&gt;_www&lt;/<span class="pl-ent">param</span>&gt;
    &lt;<span class="pl-ent">param</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>group<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span>&gt;staff&lt;/<span class="pl-ent">param</span>&gt;
    &lt;<span class="pl-ent">param</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>umask<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span>&gt;0002&lt;/<span class="pl-ent">param</span>&gt;
  &lt;/<span class="pl-ent">params</span>&gt;

  &lt;<span class="pl-ent">containers</span>&gt;

    <span class="pl-c">&lt;!-- by default we combine all servers in one container --&gt;</span>
    &lt;<span class="pl-ent">container</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>combined-appserver<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>AppserverIo\Core\GenericContainer<span class="pl-pds">"</span></span>&gt;
      &lt;<span class="pl-ent">description</span>&gt;
        <span class="pl-s"><span class="pl-pds">&lt;![CDATA[</span></span>
<span class="pl-s">          This is an example of a webserver container</span>
<span class="pl-s">          that handles http requests in common way</span>
<span class="pl-s">        <span class="pl-pds">]]&gt;</span></span>
      &lt;/<span class="pl-ent">description</span>&gt;
      &lt;<span class="pl-ent">deployment</span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>AppserverIo\Appserver\Core\GenericDeployment<span class="pl-pds">"</span></span> /&gt;
      &lt;<span class="pl-ent">host</span>
        <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>localhost<span class="pl-pds">"</span></span>
        <span class="pl-e">appBase</span>=<span class="pl-s"><span class="pl-pds">"</span>/webapps<span class="pl-pds">"</span></span>
        <span class="pl-e">serverAdmin</span>=<span class="pl-s"><span class="pl-pds">"</span>info@appserver.io<span class="pl-pds">"</span></span>
        <span class="pl-e">serverSoftware</span>=<span class="pl-s"><span class="pl-pds">"</span>appserver/1.0.0-beta (mac) PHP/5.5.16<span class="pl-pds">"</span></span> /&gt;

        &lt;<span class="pl-ent">servers</span>&gt;

          <span class="pl-c">&lt;!-- this is the default configuration for the HTTP server --&gt;</span>
          &lt;<span class="pl-ent">server</span>
            <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>http<span class="pl-pds">"</span></span>
            <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>\AppserverIo\Server\Servers\MultiThreadedServer<span class="pl-pds">"</span></span>
            <span class="pl-e">worker</span>=<span class="pl-s"><span class="pl-pds">"</span>\AppserverIo\Server\Workers\ThreadWorker<span class="pl-pds">"</span></span>
            <span class="pl-e">socket</span>=<span class="pl-s"><span class="pl-pds">"</span>\AppserverIo\Server\Sockets\StreamSocket<span class="pl-pds">"</span></span>
            <span class="pl-e">serverContext</span>=<span class="pl-s"><span class="pl-pds">"</span>\AppserverIo\Server\Contexts\ServerContext<span class="pl-pds">"</span></span>
            <span class="pl-e">requestContext</span>=<span class="pl-s"><span class="pl-pds">"</span>\AppserverIo\Server\Contexts\RequestContext<span class="pl-pds">"</span></span>
            <span class="pl-e">loggerName</span>=<span class="pl-s"><span class="pl-pds">"</span>System<span class="pl-pds">"</span></span>&gt;

            <span class="pl-c">&lt;!-- define the parameters to configure the server instance --&gt;</span>
            &lt;<span class="pl-ent">params</span>&gt;
              &lt;<span class="pl-ent">param</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>admin<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span>&gt;info@appserver.io&lt;/<span class="pl-ent">param</span>&gt;
              &lt;<span class="pl-ent">param</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>software<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span>&gt;
                appserver/1.0.0.0 (darwin) PHP/5.5.16
              &lt;/<span class="pl-ent">param</span>&gt;
                &lt;<span class="pl-ent">param</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>transport<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span>&gt;tcp&lt;/<span class="pl-ent">param</span>&gt;
                &lt;<span class="pl-ent">param</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>address<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span>&gt;127.0.0.1&lt;/<span class="pl-ent">param</span>&gt;
                &lt;<span class="pl-ent">param</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>port<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>integer<span class="pl-pds">"</span></span>&gt;9080&lt;/<span class="pl-ent">param</span>&gt;
                &lt;<span class="pl-ent">param</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>workerNumber<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>integer<span class="pl-pds">"</span></span>&gt;64&lt;/<span class="pl-ent">param</span>&gt;
                &lt;<span class="pl-ent">param</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>workerAcceptMin<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>integer<span class="pl-pds">"</span></span>&gt;3&lt;/<span class="pl-ent">param</span>&gt;
                &lt;<span class="pl-ent">param</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>workerAcceptMax<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>integer<span class="pl-pds">"</span></span>&gt;8&lt;/<span class="pl-ent">param</span>&gt;
                &lt;<span class="pl-ent">param</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>documentRoot<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span>&gt;webapps&lt;/<span class="pl-ent">param</span>&gt;
                &lt;<span class="pl-ent">param</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>directoryIndex<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span>&gt;
                    index.do index.php index.html index.htm
                &lt;/<span class="pl-ent">param</span>&gt;
                &lt;<span class="pl-ent">param</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>keepAliveMax<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>integer<span class="pl-pds">"</span></span>&gt;64&lt;/<span class="pl-ent">param</span>&gt;
                &lt;<span class="pl-ent">param</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>keepAliveTimeout<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>integer<span class="pl-pds">"</span></span>&gt;5&lt;/<span class="pl-ent">param</span>&gt;
                &lt;<span class="pl-ent">param</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>errorsPageTemplatePath<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span>&gt;
                    var/www/errors/error.phtml
                &lt;/<span class="pl-ent">param</span>&gt;
            &lt;/<span class="pl-ent">params</span>&gt;

            <span class="pl-c">&lt;!-- define the environment variables --&gt;</span>
            &lt;<span class="pl-ent">environmentVariables</span>&gt;
              &lt;<span class="pl-ent">environmentVariable</span>
                <span class="pl-e">condition</span>=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span> <span class="pl-e">definition</span>=<span class="pl-s"><span class="pl-pds">"</span>LOGGER_ACCESS=Access<span class="pl-pds">"</span></span> /&gt;
            &lt;/<span class="pl-ent">environmentVariables</span>&gt;

            <span class="pl-c">&lt;!-- define the connection handler(s) --&gt;</span>
            &lt;<span class="pl-ent">connectionHandlers</span>&gt;
              &lt;<span class="pl-ent">connectionHandler</span>
                <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>\AppserverIo\WebServer\ConnectionHandlers\HttpConnectionHandler<span class="pl-pds">"</span></span> /&gt;
            &lt;/<span class="pl-ent">connectionHandlers</span>&gt;

            <span class="pl-c">&lt;!-- define authentication basic/digest --&gt;</span>
            &lt;<span class="pl-ent">authentications</span>&gt;
              &lt;<span class="pl-ent">authentication</span> <span class="pl-e">uri</span>=<span class="pl-s"><span class="pl-pds">"</span>^\/admin.*<span class="pl-pds">"</span></span>&gt;
                &lt;<span class="pl-ent">params</span>&gt;
                  &lt;<span class="pl-ent">param</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span>&gt;
                    \AppserverIo\Http\Authentication\BasicAuthentication
                  &lt;/<span class="pl-ent">param</span>&gt;
                  &lt;<span class="pl-ent">param</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>realm<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span>&gt;
                    appserver.io Basic Authentication System
                  &lt;/<span class="pl-ent">param</span>&gt;
                  &lt;<span class="pl-ent">param</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>hash<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span>&gt;
                    YXBwc2VydmVyOmFwcHNlcnZlci5pMA==
                  &lt;/<span class="pl-ent">param</span>&gt;
                &lt;/<span class="pl-ent">params</span>&gt;
              &lt;/<span class="pl-ent">authentication</span>&gt;
            &lt;/<span class="pl-ent">authentications</span>&gt;

            <span class="pl-c">&lt;!-- allow access to everything --&gt;</span>
            &lt;<span class="pl-ent">accesses</span>&gt;
              &lt;<span class="pl-ent">access</span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>allow<span class="pl-pds">"</span></span>&gt;
                &lt;<span class="pl-ent">params</span>&gt;
                  &lt;<span class="pl-ent">param</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>X_REQUEST_URI<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span>&gt;.*&lt;/<span class="pl-ent">param</span>&gt;
                &lt;/<span class="pl-ent">params</span>&gt;
              &lt;/<span class="pl-ent">access</span>&gt;
            &lt;/<span class="pl-ent">accesses</span>&gt;

            <span class="pl-c">&lt;!-- define a virtual host --&gt;</span>
            &lt;<span class="pl-ent">virtualHosts</span>&gt;
              &lt;<span class="pl-ent">virtualHost</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>example.local<span class="pl-pds">"</span></span>&gt;
                &lt;<span class="pl-ent">params</span>&gt;
                  &lt;<span class="pl-ent">param</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>admin<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span>&gt;
                    admin@appserver.io
                  &lt;/<span class="pl-ent">param</span>&gt;
                  &lt;<span class="pl-ent">param</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>documentRoot<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span>&gt;
                    /opt/appserver/webapps/example
                  &lt;/<span class="pl-ent">param</span>&gt;
                &lt;/<span class="pl-ent">params</span>&gt;
              &lt;/<span class="pl-ent">virtualHost</span>&gt;
            &lt;/<span class="pl-ent">virtualHosts</span>&gt;

            <span class="pl-c">&lt;!-- the webserver modules we want to load --&gt;</span>
            &lt;<span class="pl-ent">modules</span>&gt;
              <span class="pl-c">&lt;!-- REQUEST_POST hook --&gt;</span>
              &lt;<span class="pl-ent">module</span>
                <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>\AppserverIo\WebServer\Modules\VirtualHostModule<span class="pl-pds">"</span></span>/&gt;
              &lt;<span class="pl-ent">module</span>
                <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>\AppserverIo\WebServer\Modules\AuthenticationModule<span class="pl-pds">"</span></span>/&gt;
              &lt;<span class="pl-ent">module</span>
                <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>\AppserverIo\WebServer\Modules\EnvironmentVariableModule<span class="pl-pds">"</span></span> /&gt;
              &lt;<span class="pl-ent">module</span>
                <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>\AppserverIo\WebServer\Modules\RewriteModule<span class="pl-pds">"</span></span>/&gt;
              &lt;<span class="pl-ent">module</span>
                <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>\AppserverIo\WebServer\Modules\DirectoryModule<span class="pl-pds">"</span></span>/&gt;
              &lt;<span class="pl-ent">module</span>
                <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>\AppserverIo\WebServer\Modules\AccessModule<span class="pl-pds">"</span></span>/&gt;
              &lt;<span class="pl-ent">module</span>
                <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>\AppserverIo\WebServer\Modules\CoreModule<span class="pl-pds">"</span></span>/&gt;
              &lt;<span class="pl-ent">module</span>
                <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>\AppserverIo\WebServer\Modules\PhpModule<span class="pl-pds">"</span></span>/&gt;
              &lt;<span class="pl-ent">module</span>
                <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>\AppserverIo\WebServer\Modules\FastCgiModule<span class="pl-pds">"</span></span>/&gt;
              &lt;<span class="pl-ent">module</span>
                <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>\AppserverIo\Appserver\ServletEngine\ServletEngine<span class="pl-pds">"</span></span> /&gt;
              <span class="pl-c">&lt;!-- RESPONSE_PRE hook --&gt;</span>
              &lt;<span class="pl-ent">module</span>
                <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>\AppserverIo\WebServer\Modules\DeflateModule<span class="pl-pds">"</span></span>/&gt;
              <span class="pl-c">&lt;!-- RESPONSE_POST hook --&gt;</span>
              &lt;<span class="pl-ent">module</span>
                <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>\AppserverIo\Appserver\Core\Modules\ProfileModule<span class="pl-pds">"</span></span>/&gt;
            &lt;/<span class="pl-ent">modules</span>&gt;

            <span class="pl-c">&lt;!-- bound the file extensions to the responsible module --&gt;</span>
            &lt;<span class="pl-ent">fileHandlers</span>&gt;
              &lt;<span class="pl-ent">fileHandler</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>servlet<span class="pl-pds">"</span></span> <span class="pl-e">extension</span>=<span class="pl-s"><span class="pl-pds">"</span>.do<span class="pl-pds">"</span></span> /&gt;
              &lt;<span class="pl-ent">fileHandler</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>fastcgi<span class="pl-pds">"</span></span> <span class="pl-e">extension</span>=<span class="pl-s"><span class="pl-pds">"</span>.php<span class="pl-pds">"</span></span>&gt;
                &lt;<span class="pl-ent">params</span>&gt;
                  &lt;<span class="pl-ent">param</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>host<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span>&gt;127.0.0.1&lt;/<span class="pl-ent">param</span>&gt;
                  &lt;<span class="pl-ent">param</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>port<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>integer<span class="pl-pds">"</span></span>&gt;9010&lt;/<span class="pl-ent">param</span>&gt;
                &lt;/<span class="pl-ent">params</span>&gt;
              &lt;/<span class="pl-ent">fileHandler</span>&gt;
            &lt;/<span class="pl-ent">fileHandlers</span>&gt;

        &lt;/<span class="pl-ent">server</span>&gt;

        <span class="pl-c">&lt;!-- Here, additional servers might be added --&gt;</span>

      &lt;/<span class="pl-ent">servers</span>&gt;
    &lt;/<span class="pl-ent">container</span>&gt;
  &lt;/<span class="pl-ent">containers</span>&gt;
&lt;/<span class="pl-ent">appserver</span>&gt;</pre></div>

<p>In the above example you can see three important components of the appserver architecture being
used. The <a href="docs/docs/architecture.md#container"><em>container</em></a>, <a href="docs/docs/architecture.md#server"><em>server</em></a> and a
<a href="docs/docs/architecture.md#protocol"><em>protocol</em></a> (if you did not read about our basic <a href="docs/docs/architecture.md">architecture</a>
you should now). We are basically building up a container which holds a server using the websocket
protocol to handle incoming requests.</p>

<h3>
<a id="container-configuration" class="anchor" href="#container-configuration" aria-hidden="true"><span class="octicon octicon-link"></span></a>Container Configuration</h3>

<p>A <em>container</em> is created by using the <code>container</code> element within the <code>containers</code> collection
of the <code>appserver</code> document element. Two parts of the XML create a specific container, in the system on startup:</p>

<ul>
<li><p>The <code>type</code> attribute states a class extending our <code>AbstractContainerThread</code>, which defines a
container to be a specific type of container.</p></li>
<li><p>The <code>deployment</code> element states a class containing preparations for starting up the container.
It can be considered a hook, which will be invoked before the container will be available.</p></li>
</ul>

<p>That is basically everything there is to do to create a new container. To make use of it, it has
to contain at least one <em>server</em> within its <code>servers</code> collection.</p>

<h3>
<a id="server-configuration" class="anchor" href="#server-configuration" aria-hidden="true"><span class="octicon octicon-link"></span></a>Server Configuration</h3>

<p>The <em>servers</em> contained by our <em>container</em> can also be loosely drafted by the XML configuration and
will be instantiated on container boot-up. To enable a <em>server</em> you have to mention three basic
attributes of the element:</p>

<ul>
<li><p>The <code>type</code> specifies a class implementing the <code>ServerInterface</code>, which implements the basic
behaviour of the server on receiving a connection and how it will handle it.</p></li>
<li><p>The <code>socket</code> attribute specifies the type of socket the server should open. E.g. a stream or
asynchronous socket</p></li>
<li><p>The <code>serverContext</code> specifies the server's source of configuration and container for runtime
information e.g. ServerVariables like <code>DOCUMENT_ROOT</code></p></li>
</ul>

<p>So we have our specific server which will open a certain port and operate in a defined context. But
to make the server handle a certain type of request, it needs to know which <em>protocol</em> to speak.</p>

<p>This can be done using the <code>connectionHandler</code> element. Certain server wrappers can handle certain
protocols. Therefore, we can use the protocols which a server wrapper, e.g. <code>WebServer</code> supports in
form of connection handlers. <a href="https://github.com/appserver.io/webserver">WebServer</a>
offers a <code>HttpConnectionHandler</code> class. By using it, the server is able to understand the HTTP
protocol.</p>

<h3>
<a id="application-configuration" class="anchor" href="#application-configuration" aria-hidden="true"><span class="octicon octicon-link"></span></a>Application Configuration</h3>

<p>Beside the Container and Server configuration, it is also possible to configure an application. Each application
can have it's own autoloaders and managers. By default, each application found in the application
servers webapp directory <code>/opt/appserver/webapps</code> will be initialized with the defaults, defined
in <code>/opt/appserver/etc/appserver/conf.d/context.xml</code></p>

<div class="highlight highlight-text-xml"><pre>&lt;?<span class="pl-ent">xml</span><span class="pl-e"> version</span>=<span class="pl-s"><span class="pl-pds">"</span>1.0<span class="pl-pds">"</span></span><span class="pl-e"> encoding</span>=<span class="pl-s"><span class="pl-pds">"</span>UTF-8<span class="pl-pds">"</span></span>?&gt;
&lt;<span class="pl-ent">context</span>
  <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>globalBaseContext<span class="pl-pds">"</span></span>
  <span class="pl-e">factory</span>=<span class="pl-s"><span class="pl-pds">"</span>AppserverIo\Appserver\Application\ApplicationFactory<span class="pl-pds">"</span></span>
  <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>AppserverIo\Appserver\Application\Application<span class="pl-pds">"</span></span>
  <span class="pl-e">xmlns</span>=<span class="pl-s"><span class="pl-pds">"</span>http://www.appserver.io/appserver<span class="pl-pds">"</span></span>&gt;

  <span class="pl-c">&lt;!--</span>
<span class="pl-c">  &lt;params&gt;</span>
<span class="pl-c">    &lt;param name="cache.dir" type="string"&gt;/cache&lt;/param&gt;</span>
<span class="pl-c">    &lt;param name="session.dir" type="string"&gt;/session&lt;/param&gt;</span>
<span class="pl-c">  &lt;/params&gt;</span>
<span class="pl-c">  --&gt;</span>

  &lt;<span class="pl-ent">classLoaders</span>&gt;

    <span class="pl-c">&lt;!-- necessary to load files from the vendor directory of your application --&gt;</span>
    &lt;<span class="pl-ent">classLoader</span>
      <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>ComposerClassLoader<span class="pl-pds">"</span></span>
      <span class="pl-e">interface</span>=<span class="pl-s"><span class="pl-pds">"</span>ClassLoaderInterface<span class="pl-pds">"</span></span>
      <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>AppserverIo\Appserver\Core\ComposerClassLoader<span class="pl-pds">"</span></span>
      <span class="pl-e">factory</span>=<span class="pl-s"><span class="pl-pds">"</span>AppserverIo\Appserver\Core\ComposerClassLoaderFactory<span class="pl-pds">"</span></span>&gt;
      &lt;<span class="pl-ent">directories</span>&gt;
        &lt;<span class="pl-ent">directory</span>&gt;/vendor&lt;/<span class="pl-ent">directory</span>&gt;
      &lt;/<span class="pl-ent">directories</span>&gt;
    &lt;/<span class="pl-ent">classLoader</span>&gt;

    <span class="pl-c">&lt;!-- necessary to load files from WEB-INF/classes and META-INF/classes, also --&gt;</span>
    <span class="pl-c">&lt;!-- provides the functionality for Design-by-Contract and AOP               --&gt;</span>
    &lt;<span class="pl-ent">classLoader</span>
      <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>DgClassLoader<span class="pl-pds">"</span></span>
      <span class="pl-e">interface</span>=<span class="pl-s"><span class="pl-pds">"</span>ClassLoaderInterface<span class="pl-pds">"</span></span>
      <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>AppserverIo\Appserver\Core\DgClassLoader<span class="pl-pds">"</span></span>
      <span class="pl-e">factory</span>=<span class="pl-s"><span class="pl-pds">"</span>AppserverIo\Appserver\Core\DgClassLoaderFactory<span class="pl-pds">"</span></span>&gt;
      &lt;<span class="pl-ent">params</span>&gt;
        &lt;<span class="pl-ent">param</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>environment<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span>&gt;production&lt;/<span class="pl-ent">param</span>&gt;
        &lt;<span class="pl-ent">param</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>enforcementLevel<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>integer<span class="pl-pds">"</span></span>&gt;7&lt;/<span class="pl-ent">param</span>&gt;
        &lt;<span class="pl-ent">param</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>typeSafety<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>boolean<span class="pl-pds">"</span></span>&gt;1&lt;/<span class="pl-ent">param</span>&gt;
        &lt;<span class="pl-ent">param</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>processing<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span>&gt;logging&lt;/<span class="pl-ent">param</span>&gt;
      &lt;/<span class="pl-ent">params</span>&gt;
      &lt;<span class="pl-ent">directories</span>&gt;
        &lt;<span class="pl-ent">directory</span> <span class="pl-e">enforced</span>=<span class="pl-s"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span>&gt;/common/classes&lt;/<span class="pl-ent">directory</span>&gt;
        &lt;<span class="pl-ent">directory</span> <span class="pl-e">enforced</span>=<span class="pl-s"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span>&gt;/WEB-INF/classes&lt;/<span class="pl-ent">directory</span>&gt;
        &lt;<span class="pl-ent">directory</span> <span class="pl-e">enforced</span>=<span class="pl-s"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span>&gt;/META-INF/classes&lt;/<span class="pl-ent">directory</span>&gt;
      &lt;/<span class="pl-ent">directories</span>&gt;
    &lt;/<span class="pl-ent">classLoader</span>&gt;
  &lt;/<span class="pl-ent">classLoaders</span>&gt;

  &lt;<span class="pl-ent">managers</span>&gt;

    <span class="pl-c">&lt;!-- provides object management services --&gt;</span>
    &lt;<span class="pl-ent">manager</span>
      <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>ObjectManagerInterface<span class="pl-pds">"</span></span>
      <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>AppserverIo\Appserver\DependencyInjectionContainer\ObjectManager<span class="pl-pds">"</span></span>
      <span class="pl-e">factory</span>=<span class="pl-s"><span class="pl-pds">"</span>AppserverIo\Appserver\DependencyInjectionContainer\ObjectManagerFactory<span class="pl-pds">"</span></span>&gt;
      &lt;<span class="pl-ent">descriptors</span>&gt;
        &lt;<span class="pl-ent">descriptor</span>&gt;AppserverIo\Appserver\DependencyInjectionContainer\Description\ServletDescriptor&lt;/<span class="pl-ent">descriptor</span>&gt;
        &lt;<span class="pl-ent">descriptor</span>&gt;AppserverIo\Appserver\DependencyInjectionContainer\Description\SingletonSessionBeanDescriptor&lt;/<span class="pl-ent">descriptor</span>&gt;
        &lt;<span class="pl-ent">descriptor</span>&gt;AppserverIo\Appserver\DependencyInjectionContainer\Description\StatefulSessionBeanDescriptor&lt;/<span class="pl-ent">descriptor</span>&gt;
        &lt;<span class="pl-ent">descriptor</span>&gt;AppserverIo\Appserver\DependencyInjectionContainer\Description\StatelessSessionBeanDescriptor&lt;/<span class="pl-ent">descriptor</span>&gt;
        &lt;<span class="pl-ent">descriptor</span>&gt;AppserverIo\Appserver\DependencyInjectionContainer\Description\MessageDrivenBeanDescriptor&lt;/<span class="pl-ent">descriptor</span>&gt;
      &lt;/<span class="pl-ent">descriptors</span>&gt;
    &lt;/<span class="pl-ent">manager</span>&gt;

    <span class="pl-c">&lt;!-- provides services necessary for DI --&gt;</span>
    &lt;<span class="pl-ent">manager</span>
      <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>ProviderInterface<span class="pl-pds">"</span></span>
      <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>AppserverIo\Appserver\DependencyInjectionContainer\Provider<span class="pl-pds">"</span></span>
      <span class="pl-e">factory</span>=<span class="pl-s"><span class="pl-pds">"</span>AppserverIo\Appserver\DependencyInjectionContainer\ProviderFactory<span class="pl-pds">"</span></span>/&gt;

    <span class="pl-c">&lt;!-- provides the services necessary to handle Session- and MessageBeans --&gt;</span>
    &lt;<span class="pl-ent">manager</span>
      <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>BeanContextInterface<span class="pl-pds">"</span></span>
      <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>AppserverIo\Appserver\PersistenceContainer\BeanManager<span class="pl-pds">"</span></span>
      <span class="pl-e">factory</span>=<span class="pl-s"><span class="pl-pds">"</span>AppserverIo\Appserver\PersistenceContainer\BeanManagerFactory<span class="pl-pds">"</span></span>&gt;
        <span class="pl-c">&lt;!-- params&gt;</span>
<span class="pl-c">          &lt;param name="lifetime" type="integer"&gt;1440&lt;/param&gt;</span>
<span class="pl-c">          &lt;param name="garbageCollectionProbability" type="float"&gt;0.1&lt;/param&gt;</span>
<span class="pl-c">        &lt;/params --&gt;</span>
        &lt;<span class="pl-ent">directories</span>&gt;
          &lt;<span class="pl-ent">directory</span>&gt;/META-INF/classes&lt;/<span class="pl-ent">directory</span>&gt;
        &lt;/<span class="pl-ent">directories</span>&gt;
      &lt;/<span class="pl-ent">manager</span>&gt;

      <span class="pl-c">&lt;!-- provides the functionality to define and run a Queue --&gt;</span>
      &lt;<span class="pl-ent">manager</span>
        <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>QueueContextInterface<span class="pl-pds">"</span></span>
        <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>AppserverIo\Appserver\MessageQueue\QueueManager<span class="pl-pds">"</span></span>
        <span class="pl-e">factory</span>=<span class="pl-s"><span class="pl-pds">"</span>AppserverIo\Appserver\MessageQueue\QueueManagerFactory<span class="pl-pds">"</span></span>/&gt;

      <span class="pl-c">&lt;!-- provides the functionality to define Servlets handling HTTP request --&gt;</span>
      &lt;<span class="pl-ent">manager</span>
        <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>ServletContextInterface<span class="pl-pds">"</span></span>
        <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>AppserverIo\Appserver\ServletEngine\ServletManager<span class="pl-pds">"</span></span>
        <span class="pl-e">factory</span>=<span class="pl-s"><span class="pl-pds">"</span>AppserverIo\Appserver\ServletEngine\ServletManagerFactory<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">directories</span>&gt;
          &lt;<span class="pl-ent">directory</span>&gt;/WEB-INF/classes&lt;/<span class="pl-ent">directory</span>&gt;
        &lt;/<span class="pl-ent">directories</span>&gt;
      &lt;/<span class="pl-ent">manager</span>&gt;

      <span class="pl-c">&lt;!-- provides functionality to handle HTTP sessions --&gt;</span>
      &lt;<span class="pl-ent">manager</span>
        <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>SessionManagerInterface<span class="pl-pds">"</span></span>
        <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>AppserverIo\Appserver\ServletEngine\StandardSessionManager<span class="pl-pds">"</span></span>
        <span class="pl-e">factory</span>=<span class="pl-s"><span class="pl-pds">"</span>AppserverIo\Appserver\ServletEngine\StandardSessionManagerFactory<span class="pl-pds">"</span></span>/&gt;

      <span class="pl-c">&lt;!-- provides functionality to handle Timers --&gt;</span>
      &lt;<span class="pl-ent">manager</span>
        <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>TimerServiceContextInterface<span class="pl-pds">"</span></span>
        <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>AppserverIo\Appserver\PersistenceContainer\TimerServiceRegistry<span class="pl-pds">"</span></span>
        <span class="pl-e">factory</span>=<span class="pl-s"><span class="pl-pds">"</span>AppserverIo\Appserver\PersistenceContainer\TimerServiceRegistryFactory<span class="pl-pds">"</span></span>/&gt;

      <span class="pl-c">&lt;!-- provides functionality to handle HTTP basic/digest authentication --&gt;</span>
      &lt;<span class="pl-ent">manager</span>
        <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>AuthenticationManagerInterface<span class="pl-pds">"</span></span>
        <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>AppserverIo\Appserver\ServletEngine\Authentication\StandardAuthenticationManager<span class="pl-pds">"</span></span>
        <span class="pl-e">factory</span>=<span class="pl-s"><span class="pl-pds">"</span>AppserverIo\Appserver\ServletEngine\Authentication\StandardAuthenticationManagerFactory<span class="pl-pds">"</span></span>/&gt;

      <span class="pl-c">&lt;!-- provides functionality to preload Advices found in WEB-INF/classes or META-INF/classes --&gt;</span>
      &lt;<span class="pl-ent">manager</span>
        <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>AspectManagerInterface<span class="pl-pds">"</span></span>
        <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>AppserverIo\Appserver\AspectContainer\AspectManager<span class="pl-pds">"</span></span>
        <span class="pl-e">factory</span>=<span class="pl-s"><span class="pl-pds">"</span>AppserverIo\Appserver\AspectContainer\AspectManagerFactory<span class="pl-pds">"</span></span>/&gt;
  &lt;/<span class="pl-ent">managers</span>&gt;
&lt;/<span class="pl-ent">context</span>&gt;</pre></div>

<p>If your application doesn't use any of the defined class loaders or managers or you want to implement
your own managers, you can define them in a <code>context.xml</code> file, which you must include with your
application. Your own customized file, has to be stored in <code>META-INF/context.xml</code>. When the application
server starts, this file will be parsed and your application will be initialized with the class loaders
and managers you have defined there.</p>

<blockquote>
<p>Please be aware: the default class loaders and managers provide most of the functionality
described above. So if you remove them from the <code>context.xml</code>, you have to expect unexpected and incorrect behaviour.</p>
</blockquote>

<h3>
<a id="module-configuration" class="anchor" href="#module-configuration" aria-hidden="true"><span class="octicon octicon-link"></span></a>Module Configuration</h3>

<p>The web server comes with a package of default modules. The functionality that allows us to configure
a virtual host or environment variables, for example, is also provided by two very important modules.</p>

<h4>
<a id="rewrite-module" class="anchor" href="#rewrite-module" aria-hidden="true"><span class="octicon octicon-link"></span></a>Rewrite Module</h4>

<p>The rewrite module can be used according to the <code>\AppserverIo\WebServer\Interfaces\HttpModuleInterface</code> interface.
It needs an initial call of the <code>init</code> method and will process any request offered to the <code>process</code> method.
The module is best used within the <a href="https://github.com/appserver-io/webserver"><code>webserver</code></a>
project, as it offers all the needed infrastructure.</p>

<h5>
<a id="rules" class="anchor" href="#rules" aria-hidden="true"><span class="octicon octicon-link"></span></a>Rules</h5>

<p>Most important part of the rewrite module is the way in which it can perform rewrites. All rewrites are
based on rewrite rules which consist of three important parts:</p>

<ul>
<li><p><em>condition string</em> : Conditions, which have to be met in order for the rule to take effect.
This is explained in more detail <a href="#condition-syntax">under condition syntax</a></p></li>
<li>
<p><em>target string</em> : The target to rewrite the requested URI to. Within this string you can use
backreferences similar
to the Apache mod_rewrite module with the difference that you have to use the <code>$ syntax</code>
(instead of the <code>$/%/%{} syntax</code> of Apache).</p>

<p>Matching rule conditions, which you specifically pick out via regex are also part of available back-references
as well as server and environment variables.</p>

<p><em>Simple example</em> : A condition like <code>(.+)@$X_REQUEST_URI</code> would produce a back reference <code>$1</code>
with the value <code>/index</code> for a requested URI <code>/index</code>. The target string <code>$1/welcome.html</code> would
therefore result in a rewrite to <code>/index/welcome.html</code></p>
</li>
<li><p><em>flag string</em> : You can use flags similar to mod_rewrite which are used to make rules react in a
certain way or influence further processing. Learn more in the section <a href="#flags">on flage</a></p></li>
</ul>

<h5>
<a id="condition-syntax" class="anchor" href="#condition-syntax" aria-hidden="true"><span class="octicon octicon-link"></span></a>Condition Syntax</h5>

<p>The Syntax of possible conditions is roughly based on the possibilities of Apache's RewriteCondition
and RewriteRule combined.</p>

<p>To make use of such a combination you can chain conditions together using the <code>{OR}</code> symbol for
OR-combined, and the <code>{AND}</code> symbol for AND-combined conditions.</p>

<p>Please be aware that AND takes precedence over OR! Conditions can either be PCRE regex or certain fixed
expressions. So a condition string of <code>([A-Z]+\.txt){OR}^/([0-9]+){AND}-f</code> would match only real files
(through <code>-f</code>) which either begin with numbers or end with capital letters and the extension .txt.</p>

<p>As you might have noticed: Backslashes do <strong>not have to be escaped</strong>.</p>

<p>You might also be curious of the <code>-f</code> condition. This is a direct copy of Apaches -f RewriteCondition.
We also support several other expressions to regex based conditions which are:</p>

<ul>
<li>
<em>&lt;</em> : Is the operand lexically preceding <code>&lt;COMPARE_STRING&gt;</code>?</li>
<li>
<em>&gt;</em> : Is the operand lexically following <code>&lt;COMPARE_STRING&gt;</code>?</li>
<li>
<em>=</em> : Is the operand lexically equal to <code>&lt;COMPARE_STRING&gt;</code>?</li>
<li>
<em>-d</em> : Is the operand a directory?</li>
<li>
<em>-f</em> : Is the operand a real file?</li>
<li>
<em>-s</em> : Is the operand a real file of a size greater than 0?</li>
<li>
<em>-l</em> : Is the operand a symbolic link?</li>
<li>
<em>-x</em> : Is the operand an executable file?</li>
</ul>

<p>If you are wondering what the <code>operand</code> might be: it is <strong>whatever you want it to be</strong>! You can specify
any operand you like using the <code>@</code> symbol. All conditions within a rule will use the next operand to
their right and if none is given the requested URI. For example:</p>

<ul>
<li>
<em><code>([A-Z]+\.txt){OR}^/([0-9]+)</code></em> Will take the requested URI for both conditions (note the <code>{OR}</code> symbol)</li>
<li>
<em><code>([A-Z]+\.txt){OR}^/([0-9]+)@$DOCUMENT_ROOT</code></em> Will test both conditions against the document root</li>
<li>
<em><code>([A-Z]+\.txt)@$DOCUMENT_ROOT{OR}^/([0-9]+)</code></em> Will only test the first one against the document root
and the second against the requested URI</li>
</ul>

<p>You might have noted the <code>$</code> symbol before <code>DOCUMENT_ROOT</code> and remembered it from the back-reference
syntax. That's because all Apache common server vars can be explicitly used as back-references too!</p>

<p>That does not work for you? Need the exact opposite? No problem!</p>

<p>All conditions, whether regex or expression based can be negated using the <code>!</code> symbol in front of
them! So <code>!^([0-9]+)</code> would match all strings which do NOT begin with a number and <code>!-d</code> would match
all non-directories.</p>

<h5>
<a id="flags" class="anchor" href="#flags" aria-hidden="true"><span class="octicon octicon-link"></span></a>Flags</h5>

<p>Flags are used to further influence processing. You can specify as many flags per rewrite as you like,
but be aware of their impact! Syntax for several flags is simple: just separate them with a <code>,</code> symbol.
Flags which might accept a parameter can be assigned one by using the <code>=</code> symbol. Currently supported
flags are:</p>

<ul>
<li><p><em>L</em> : As rules are normally processed one after the other, the <code>L</code> flag will make the flagged rule
the last one processed if matched.</p></li>
<li><p><em>R</em> : If this flag is set we will redirect the client to the URL specified in the <code>target string</code>.
If this is just a URI, we will redirect to the same host. You might also specify a custom status
code between 300 and 399 to indicate the reason for/kind of the redirect. Default is <code>301</code> aka
<code>permanent</code></p></li>
<li><p><em>M</em> : Stands for map. Using this flag you can specify an external source (have a look at the Injector
classes of the WebServer project) of a target map. With <code>M=&lt;MY_BACKREFERENCE&gt;</code> you can specify what
the map's index has to be to match. This matching is done <strong>only</strong> if the rewrite condition matches and will
behave as another condition</p></li>
</ul>

<h4>
<a id="virtual-host-module" class="anchor" href="#virtual-host-module" aria-hidden="true"><span class="octicon octicon-link"></span></a>Virtual-Host Module</h4>

<p>The module can be used according to the <code>\AppserverIo\WebServer\Interfaces\HttpModuleInterface</code>
interface. It needs an initial call of the <code>init</code> method and will process any request offered to
the <code>process</code> method. The module is best used within the <a href="https://github.com/appserver-io/webserver">webserver</a>
project as it offers all needed infrastructure.</p>

<p>If you need to configure a virtual host, it should look like the
following example, which enables a Magento installation under <code>http://magento.dev:9080</code>.</p>

<div class="highlight highlight-text-xml"><pre>&lt;<span class="pl-ent">virtualHosts</span>&gt;
  &lt;<span class="pl-ent">virtualHost</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>magento.dev<span class="pl-pds">"</span></span>&gt;
    &lt;<span class="pl-ent">params</span>&gt;
        &lt;<span class="pl-ent">param</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>admin<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span>&gt;info@appserver.io&lt;/<span class="pl-ent">param</span>&gt;
        &lt;<span class="pl-ent">param</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>documentRoot<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span>&gt;webapps/magento&lt;/<span class="pl-ent">param</span>&gt;
    &lt;/<span class="pl-ent">params</span>&gt;
    &lt;<span class="pl-ent">rewrites</span>&gt;
        &lt;<span class="pl-ent">rewrite</span> <span class="pl-e">condition</span>=<span class="pl-s"><span class="pl-pds">"</span>-d{OR}-f{OR}-l<span class="pl-pds">"</span></span> <span class="pl-e">target</span>=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span> <span class="pl-e">flag</span>=<span class="pl-s"><span class="pl-pds">"</span>L<span class="pl-pds">"</span></span> /&gt;
        &lt;<span class="pl-ent">rewrite</span> <span class="pl-e">condition</span>=<span class="pl-s"><span class="pl-pds">"</span>(.*)<span class="pl-pds">"</span></span> <span class="pl-e">target</span>=<span class="pl-s"><span class="pl-pds">"</span>index.php/$1<span class="pl-pds">"</span></span> <span class="pl-e">flag</span>=<span class="pl-s"><span class="pl-pds">"</span>L<span class="pl-pds">"</span></span> /&gt;
    &lt;/<span class="pl-ent">rewrites</span>&gt;
    &lt;<span class="pl-ent">accesses</span>&gt;
        &lt;<span class="pl-ent">access</span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>allow<span class="pl-pds">"</span></span>&gt;
            &lt;<span class="pl-ent">params</span>&gt;
                &lt;<span class="pl-ent">param</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>X_REQUEST_URI<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span>&gt;
                  ^\/([^\/]+\/)?(media|skin|js|index\.php).*
                &lt;/<span class="pl-ent">param</span>&gt;
            &lt;/<span class="pl-ent">params</span>&gt;
        &lt;/<span class="pl-ent">access</span>&gt;
    &lt;/<span class="pl-ent">accesses</span>&gt;
  &lt;/<span class="pl-ent">virtualHost</span>&gt;
&lt;/<span class="pl-ent">virtualHosts</span>&gt;</pre></div>

<h2>
<a id="configuration-defaults" class="anchor" href="#configuration-defaults" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuration Defaults</h2>

<p>You will see that we provide basic front-end implementations of services the appserver runtime
provides. If you want to use these services yourself, you should have a look into the code of our
apps and read about <a href="#deployment">app development</a>.</p>

<p>You might be curious about the different ports we use. Per default, the appserver will open several
ports at which it's services are available. As we do not want to block (or be blocked by) other
services, we use ports in a higher range.</p>

<p>As a default, we use the following ports:</p>

<ul>
<li>
<p>WebContainer</p>

<ul>
<li>HTTP Server: <code>9080</code>
</li>
<li>HTTPS Server: <code>9443</code>
</li>
</ul>
</li>
<li>
<p>Persistence-MQ-Container</p>

<ul>
<li>Persistence-Container: <code>8585</code>
</li>
<li>Message-Queue: <code>8587</code>
</li>
</ul>
</li>
</ul>

<p>You can change the default port mapping by using the <a href="#the-architecture">configuration file</a>.
If you are interested in our naming, you can see our container-&gt;server pattern, you might want to
have a deeper look into our <a href="docs/docs/architecture.md">architecture</a></p>

<h1>
<a id="deployment" class="anchor" href="#deployment" aria-hidden="true"><span class="octicon octicon-link"></span></a>Deployment</h1>

<p>The deploy directory in the appserver.io Application Server distribution is the location end users can place their
deployment content (e. g. phar files) to have it deployed into the server runtime.</p>

<p>Users, particularly those running production systems, are encouraged to use the appserver.io AS management APIs to
upload and deploy deployment content.</p>

<h2>
<a id="deployment-modes" class="anchor" href="#deployment-modes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Deployment Modes</h2>

<p>The scanner actually only supports a manual deployment mode, which means that you have to restart the server to process
deployment of your content. In this mode, the scanner will not attempt to directly monitor the deployment content and
decide if or when the end user wishes the content to be deployed or undeployed. Instead, the scanner relies on a system
of marker files, with the user's addition or removal of a marker file serving as a sort of command telling the scanner
to deploy, undeploy or redeploy content.</p>

<p>It is also possible to copy your unzipped content directly into the webapps folder. After restarting the webserver
your content will then be deployed without having any impact on the deployment scanner, because only zipped (.phar)
content will be recognized.</p>

<h2>
<a id="marker-files" class="anchor" href="#marker-files" aria-hidden="true"><span class="octicon octicon-link"></span></a>Marker Files</h2>

<p>The marker files always have the same name as the deployment content to which they relate, but with an additional file
suffix appended. For example, the marker file to indicate the example.phar file should be deployed is named
example.phar.dodeploy. Different marker file suffixes have different meanings.</p>

<p>The relevant marker file types are:</p>

<table>
<thead>
<tr>
<th align="left">Marker</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">.dodeploy</td>
<td align="left">Placed by the user to indicate that the given content should be deployed or redeployed into the runtime.</td>
</tr>
<tr>
<td align="left">.deploying</td>
<td align="left">Placed by the deployment scanner service to indicate that it has noticed a .dodeploy file and is in the process of deploying the content. This marker file will be deleted, when the deployment process completes.</td>
</tr>
<tr>
<td align="left">.deployed</td>
<td align="left">Placed by the deployment scanner service to indicate that the given content has been deployed into the runtime. If an end user deletes this file and no other marker is available, the content will be undeployed.</td>
</tr>
<tr>
<td align="left">.failed</td>
<td align="left">Placed by the deployment scanner service to indicate that the given content failed to deploy into the runtime. The content of the file will include some information about the cause of the failure. Note that, removing this file will make the deployment eligible for deployment again.</td>
</tr>
<tr>
<td align="left">.undeploying</td>
<td align="left">Placed by the deployment scanner service to indicate that it has noticed a .deployed file has been deleted and the content is being undeployed. This marker file will be deleted, when the undeployment process completes.</td>
</tr>
<tr>
<td align="left">.undeployed</td>
<td align="left">Placed by the deployment scanner service to indicate that the given content has been undeployed from the runtime. If this marker file is deleted by the user, it has no impact.</td>
</tr>
</tbody>
</table>

<h2>
<a id="basic-workflows" class="anchor" href="#basic-workflows" aria-hidden="true"><span class="octicon octicon-link"></span></a>Basic workflows</h2>

<p>All examples assume variable $AS points to the root of the appserver.io AS distribution.</p>

<p>Windows users: the examples below use UNIX shell commands; see the <a href="#windows-notes">Windows Notes</a> below.</p>

<ol>
<li>Add new zipped (.phar) content and deploy it:</li>
</ol>

<pre><code>$ cp target/example.phar $AS/deploy
$ touch $AS/deploy/example.phar.dodeploy
</code></pre>

<ol>
<li>Undeploy currently deployed zipped (.phar) content:</li>
</ol>

<pre><code>$ rm $AS/deploy/example.phar.deployed
</code></pre>

<ol>
<li>Replace currently deployed zipped (.phar) content with a new version and redeploy it:</li>
</ol>

<pre><code>$ cp target/example.phar $AS/deploy
$ mv $AS/deploy/example.phar.deployed $AS/deploy/example.phar.dodeploy
</code></pre>

<h2>
<a id="windows-notes" class="anchor" href="#windows-notes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Windows Notes</h2>

<p>The above examples use UNIX shell commands. Windows equivalents are:</p>

<table>
<thead>
<tr>
<th align="left">UNIX</th>
<th align="left">Windows</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">cp src dest</td>
<td align="left">xcopy /y src dest</td>
</tr>
<tr>
<td align="left">cp -r src dest</td>
<td align="left">xcopy /e /s /y src dest</td>
</tr>
<tr>
<td align="left">rm afile</td>
<td align="left">del afile</td>
</tr>
<tr>
<td align="left">touch afile</td>
<td align="left">echo &gt;&gt; afile</td>
</tr>
</tbody>
</table>

<p>Note that the behavior of <code>touch</code> and <code>echo</code> are different, but the differences are not relevant to the usages.</p>

<h1>
<a id="uninstall" class="anchor" href="#uninstall" aria-hidden="true"><span class="octicon octicon-link"></span></a>Uninstall</h1>

<p>Before uninstalling, you should <a href="#start-and-stop-scripts">stop all the services</a>, which are still running (rpm-based packages will see to that themselves), otherwise there might be problems with existing pid-files on Linux and Mac for the next time you install it.</p>

<p>To uninstall the appserver on Linux, you might rely on your package management system.
On Windows you can use the normal uninstall process provided by the operating system.</p>

<p>Under Mac OS X you can simply delete the <code>/opt/appserver</code> folder that containers all installed files.</p>

<h1>
<a id="external-links" class="anchor" href="#external-links" aria-hidden="true"><span class="octicon octicon-link"></span></a>External Links</h1>

<ul>
<li>All about appserver.io at <a href="http://www.appserver.io">appserver.io</a>
</li>
</ul>
      </section>
    </div>

    
  </body>
</html>
